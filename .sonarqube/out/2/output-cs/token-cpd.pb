Ô
PC:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CartingService\BLL\Cart.cs
	namespace 	
CartingService
 
. 
BLL 
{ 
public 

class 
Cart 
{ 
public 
Guid 
Id 
{ 
get 
; 
set !
;! "
}# $
public 
List 
< 
Item 
> 
Items 
{  !
get" %
;% &
set' *
;* +
}, -
} 
} Ã{
\C:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CartingService\BLL\CartingEFService.cs
	namespace 	
CartingService
 
. 
BLL 
{ 
public 

class 
CartingEFService !
:" #
ICartingService$ 3
{		 
private

 
readonly

 
CartingDbContext

 )
_context

* 2
;

2 3
private 
readonly 
IMapper  
_mapper! (
;( )
public 
CartingEFService 
(  
CartingDbContext  0
context1 8
,8 9
IMapper: A
mapperB H
)H I
{ 	
_context 
= 
context 
; 
_mapper 
= 
mapper 
; 
} 	
public 
async 
Task 
AddItem !
(! "
Guid" &
cartId' -
,- .
Item/ 3
item4 8
)8 9
{ 	
var 
cartDAO 
= 
await 
_context  (
.( )
Carts) .
.. /
Include/ 6
(6 7
c7 8
=>9 ;
c< =
.= >
Items> C
)C D
. 
FirstOrDefaultAsync 0
(0 1
c1 2
=>3 5
c6 7
.7 8
Id8 :
==; =
cartId> D
)D E
;E F
if 
( 
cartDAO 
== 
null 
)  
{ 
var 
cart 
= 
await  
InitializeCart! /
(/ 0
cartId0 6
,6 7
item8 <
)< =
;= >
cartDAO 
= 
_mapper !
.! "
Map" %
<% &
CartDAO& -
>- .
(. /
cart/ 3
)3 4
;4 5
} 
else 
if 
( 
item 
!= 
null !
)! "
{ 
var 
existingItem  
=! "
cartDAO# *
.* +
Items+ 0
.0 1
Find1 5
(5 6
i6 7
=>8 :
i; <
.< =
Item= A
.A B
IdB D
==E G
itemH L
.L M
IdM O
)O P
;P Q
if 
( 
existingItem  
!=! #
null$ (
)( )
existingItem    
.    !
Quantity  ! )
+=  * ,
item  - 1
.  1 2
Quantity  2 :
;  : ;
else!! 
if!! 
(!! 
await!! 

ExistsItem!! )
(!!) *
item!!* .
.!!. /
Id!!/ 1
)!!1 2
)!!2 3
{"" 
var## 
	itemToAdd## !
=##" #
_mapper##$ +
.##+ ,
Map##, /
<##/ 0
CartItemDAO##0 ;
>##; <
(##< =
item##= A
)##A B
;##B C
	itemToAdd$$ 
.$$ 
Item$$ "
=$$# $
await$$% *
GetItem$$+ 2
($$2 3
item$$3 7
.$$7 8
Id$$8 :
)$$: ;
;$$; <
cartDAO%% 
.%% 
Items%% !
.%%! "
Add%%" %
(%%% &
	itemToAdd%%& /
)%%/ 0
;%%0 1
}&& 
else'' 
{(( 
throw)) 
new)) 
ArgumentException)) /
())/ 0
$str))0 F
,))F G
nameof))H N
())N O
Item))O S
)))S T
)))T U
;))U V
}** 
}++ 
else,, 
throw-- 
new-- 
ArgumentException-- +
(--+ ,
$str--, A
,--A B
nameof--C I
(--I J
Item--J N
)--N O
)--O P
;--P Q
try.. 
{// 
await00 
_context00 
.00 
SaveChangesAsync00 /
(00/ 0
)000 1
;001 2
}11 
catch22 
(22 (
DbUpdateConcurrencyException22 /
ex220 2
)222 3
{33 
var44 
entry44 
=44 
ex44 
.44 
Entries44 &
.44& '
Single44' -
(44- .
)44. /
;44/ 0
entry55 
.55 
OriginalValues55 $
.55$ %
	SetValues55% .
(55. /
entry55/ 4
.554 5
CurrentValues555 B
)55B C
;55C D
}66 
}77 	
public88 
async88 
Task88 
<88 
bool88 
>88 

ExistsCart88  *
(88* +
Guid88+ /
cartId880 6
)886 7
{99 	
return:: 
await:: 
_context:: !
.::! "
Carts::" '
.::' (
Where::( -
(::- .
c::. /
=>::0 2
c::3 4
.::4 5
Id::5 7
==::8 :
cartId::; A
)::A B
.::B C
AnyAsync::C K
(::K L
)::L M
;::M N
};; 	
public<< 
async<< 
Task<< 
<<< 
bool<< 
><< 
ExistsItemOnCart<<  0
(<<0 1
Guid<<1 5
cartId<<6 <
,<<< =
int<<> A
itemId<<B H
)<<H I
{== 	
return>> 
await>> 
_context>> !
.>>! "
Carts>>" '
.?? 
Where?? 
(?? 
c??  
=>??! #
c??$ %
.??% &
Id??& (
==??) +
cartId??, 2
&&??3 5
c@@  !
.@@! "
Items@@" '
.@@' (
Exists@@( .
(@@. /
i@@/ 0
=>@@1 3
i@@4 5
.@@5 6
Item@@6 :
.@@: ;
Id@@; =
==@@> @
itemId@@A G
)@@G H
)@@H I
.AA 
AnyAsyncAA !
(AA! "
)AA" #
;AA# $
}BB 	
publicCC 
asyncCC 
TaskCC 
<CC 
CartCC 
>CC 
GetCartCC  '
(CC' (
GuidCC( ,
cartIdCC- 3
)CC3 4
{DD 	
varEE 
cartDAOEE 
=EE 
awaitEE 
_contextEE  (
.EE( )
CartsEE) .
.EE. /
IncludeEE/ 6
(EE6 7
cEE7 8
=>EE9 ;
cEE< =
.EE= >
ItemsEE> C
)EEC D
.EED E
FirstOrDefaultAsyncEEE X
(EEX Y
cEEY Z
=>EE[ ]
cEE^ _
.EE_ `
IdEE` b
==EEc e
cartIdEEf l
)EEl m
;EEm n
ifFF 
(FF 
cartDAOFF 
==FF 
nullFF 
)FF  
returnGG 
nullGG 
;GG 
elseHH 
returnII 
_mapperII 
.II 
MapII "
<II" #
CartII# '
>II' (
(II( )
cartDAOII) 0
)II0 1
;II1 2
}KK 	
publicLL 
asyncLL 
TaskLL 
<LL 
CartLL 
>LL 
InitializeCartLL  .
(LL. /
GuidLL/ 3
cartIdLL4 :
,LL: ;
ItemLL< @
?LL@ A
itemLLB F
)LLF G
{MM 	
varNN 
cartDAONN 
=NN 
awaitNN 
_contextNN  (
.NN( )
CartsNN) .
.NN. /
IncludeNN/ 6
(NN6 7
cNN7 8
=>NN9 ;
cNN< =
.NN= >
ItemsNN> C
)NNC D
.OO  !
FirstOrDefaultAsyncOO! 4
(OO4 5
cOO5 6
=>OO7 9
cOO: ;
.OO; <
IdOO< >
==OO? A
cartIdOOB H
)OOH I
;OOI J
ifPP 
(PP 
cartDAOPP 
==PP 
nullPP 
)PP  
{QQ 
cartDAORR 
=RR 
newRR 
CartDAORR %
(RR% &
)RR& '
{RR( )
IdRR* ,
=RR- .
cartIdRR/ 5
}RR6 7
;RR7 8
_contextSS 
.SS 
AddSS 
(SS 
cartDAOSS $
)SS$ %
;SS% &
}TT 
ifUU 
(UU 
itemUU 
!=UU 
nullUU 
&&UU 
awaitUU  %

ExistsItemUU& 0
(UU0 1
itemUU1 5
.UU5 6
IdUU6 8
)UU8 9
)UU9 :
{VV 
varWW 
itemDAOWW 
=WW 
_mapperWW %
.WW% &
MapWW& )
<WW) *
ItemWW* .
,WW. /
CartItemDAOWW0 ;
>WW; <
(WW< =
itemWW= A
)WWA B
;WWB C
itemDAOXX 
.XX 
ItemXX 
=XX 
awaitXX $
GetItemXX% ,
(XX, -
itemXX- 1
.XX1 2
IdXX2 4
)XX4 5
;XX5 6
cartDAOYY 
.YY 
ItemsYY 
=YY 
newYY  #
ListYY$ (
<YY( )
CartItemDAOYY) 4
>YY4 5
(YY5 6
)YY6 7
{YY8 9
itemDAOYY: A
}YYB C
;YYC D
}ZZ 
else[[ 
cartDAO\\ 
.\\ 
Items\\ 
=\\ 
new\\  #
List\\$ (
<\\( )
CartItemDAO\\) 4
>\\4 5
(\\5 6
)\\6 7
{\\8 9
}\\: ;
;\\; <
try]] 
{^^ 
await__ 
_context__ 
.__ 
SaveChangesAsync__ /
(__/ 0
)__0 1
;__1 2
}`` 
catchaa 
(aa (
DbUpdateConcurrencyExceptionaa /
exaa0 2
)aa2 3
{bb 
varcc 
entrycc 
=cc 
excc 
.cc 
Entriescc &
.cc& '
Singlecc' -
(cc- .
)cc. /
;cc/ 0
entrydd 
.dd 
OriginalValuesdd $
.dd$ %
	SetValuesdd% .
(dd. /
entrydd/ 4
.dd4 5
CurrentValuesdd5 B
)ddB C
;ddC D
}ee 
returnff 
_mapperff 
.ff 
Mapff 
<ff 
Cartff #
>ff# $
(ff$ %
cartDAOff% ,
)ff, -
;ff- .
}gg 	
publichh 
asynchh 
Taskhh 

RemoveItemhh $
(hh$ %
Guidhh% )
cartIdhh* 0
,hh0 1
inthh2 5
itemIdhh6 <
)hh< =
{ii 	
varjj 
cartDAOjj 
=jj 
awaitjj 
_contextjj  (
.jj( )
Cartsjj) .
.jj. /
Includejj/ 6
(jj6 7
cjj7 8
=>jj9 ;
cjj< =
.jj= >
Itemsjj> C
)jjC D
.jjD E
FirstOrDefaultAsyncjjE X
(jjX Y
cjjY Z
=>jj[ ]
cjj^ _
.jj_ `
Idjj` b
==jjc e
cartIdjjf l
)jjl m
;jjm n
ifkk 
(kk 
cartDAOkk 
==kk 
nullkk 
)kk  
returnll 
;ll 
varmm 
itemToRemovemm 
=mm 
cartDAOmm &
.mm& '
Itemsmm' ,
.mm, -
Findmm- 1
(mm1 2
imm2 3
=>mm4 6
imm7 8
.mm8 9
Itemmm9 =
.mm= >
Idmm> @
==mmA C
itemIdmmD J
)mmJ K
;mmK L
ifnn 
(nn 
itemToRemovenn 
!=nn 
nullnn  $
)nn$ %
{oo 
_contextpp 
.pp 
Removepp 
(pp  
itemToRemovepp  ,
)pp, -
;pp- .
awaitqq 
_contextqq 
.qq 
SaveChangesAsyncqq /
(qq/ 0
)qq0 1
;qq1 2
}rr 
}ss 	
publictt 
voidtt 
ItemUpdatedtt 
(tt  
MessagingServicett  0
.tt0 1
	Contractstt1 :
.tt: ;
Itemtt; ?
itemtt@ D
)ttD E
{uu 	
varvv 
itemDAOvv 
=vv 
_contextvv "
.vv" #
Itemsvv# (
.vv( )
Findvv) -
(vv- .
itemvv. 2
.vv2 3
Idvv3 5
)vv5 6
;vv6 7
ifww 
(ww 
itemDAOww 
==ww 
nullww 
)ww  
{xx 
varyy 
newItemyy 
=yy 
_mapperyy %
.yy% &
Mapyy& )
<yy) *
ItemDAOyy* 1
>yy1 2
(yy2 3
itemyy3 7
)yy7 8
;yy8 9
_contextzz 
.zz 
Itemszz 
.zz 
Addzz "
(zz" #
newItemzz# *
)zz* +
;zz+ ,
}{{ 
else|| 
{}} 
itemDAO~~ 
.~~ 
Name~~ 
=~~ 
item~~ #
.~~# $
Name~~$ (
;~~( )
itemDAO 
. 
Image 
= 
item  $
.$ %
Image% *
;* +
_context
ÄÄ 
.
ÄÄ 
Items
ÄÄ 
.
ÄÄ 
Update
ÄÄ %
(
ÄÄ% &
itemDAO
ÄÄ& -
)
ÄÄ- .
;
ÄÄ. /
}
ÅÅ 
_context
ÇÇ 
.
ÇÇ 
SaveChanges
ÇÇ  
(
ÇÇ  !
)
ÇÇ! "
;
ÇÇ" #
}
ÉÉ 	
public
ÑÑ 
void
ÑÑ 
ItemDeleted
ÑÑ 
(
ÑÑ  
int
ÑÑ  #
itemId
ÑÑ$ *
)
ÑÑ* +
{
ÖÖ 	
var
ÜÜ 
itemDAO
ÜÜ 
=
ÜÜ 
_context
ÜÜ "
.
ÜÜ" #
Items
ÜÜ# (
.
ÜÜ( )
Find
ÜÜ) -
(
ÜÜ- .
itemId
ÜÜ. 4
)
ÜÜ4 5
;
ÜÜ5 6
if
áá 
(
áá 
itemDAO
áá 
!=
áá 
null
áá 
)
áá  
{
àà 
_context
ââ 
.
ââ 
Items
ââ 
.
ââ 
Remove
ââ %
(
ââ% &
itemDAO
ââ& -
)
ââ- .
;
ââ. /
}
ää 
}
ãã 	
public
åå 
async
åå 
Task
åå 
<
åå 
bool
åå 
>
åå 

ExistsItem
åå  *
(
åå* +
int
åå+ .
itemId
åå/ 5
)
åå5 6
{
çç 	
var
éé 
item
éé 
=
éé 
await
éé 
_context
éé %
.
éé% &
Items
éé& +
.
éé+ ,
	FindAsync
éé, 5
(
éé5 6
itemId
éé6 <
)
éé< =
;
éé= >
return
èè 
item
èè 
!=
èè 
null
èè 
;
èè  
}
êê 	
private
íí 
async
íí 
Task
íí 
<
íí 
ItemDAO
íí "
>
íí" #
GetItem
íí$ +
(
íí+ ,
int
íí, /
itemId
íí0 6
)
íí6 7
{
ìì 	
return
îî 
await
îî 
_context
îî !
.
îî! "
Items
îî" '
.
îî' (
	FindAsync
îî( 1
(
îî1 2
itemId
îî2 8
)
îî8 9
;
îî9 :
}
ïï 	
}
ññ 
}óó ˆO
^C:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CartingService\BLL\CartingRepoService.cs
	namespace 	
CartingService
 
. 
BLL 
{ 
public 

class 
CartingRepoService #
:$ %
ICartingService& 5
{ 
private		 
readonly		 
ICartingRepository		 +
_repository		, 7
;		7 8
private

 
readonly

 
IMapper

  
_mapper

! (
;

( )
public 
CartingRepoService !
(! "
ICartingRepository" 4

repository5 ?
,? @
IMapperA H
mapperI O
)O P
{ 	
_repository 
= 

repository $
;$ %
_mapper 
= 
mapper 
; 
} 	
public 
async 
Task 
AddItem !
(! "
Guid" &
cartId' -
,- .
Item/ 3
item4 8
)8 9
{ 	
var 
cartDAO 
= 
await 
_repository  +
.+ ,
GetCart, 3
(3 4
cartId4 :
): ;
;; <
if 
( 
cartDAO 
== 
null 
)  
{ 
if 
( 
_repository 
.  

ExistsItem  *
(* +
item+ /
./ 0
Id0 2
)2 3
)3 4
await 
InitializeCart (
(( )
cartId) /
,/ 0
item1 5
)5 6
;6 7
else 
throw 
new 
ArgumentException /
(/ 0
$str0 F
,F G
nameofH N
(N O
ItemO S
)S T
)T U
;U V
} 
else 
if 
( 
item 
!= 
null !
)! "
{ 
var 
existingItem  
=! "
cartDAO# *
.* +
Items+ 0
.0 1
Find1 5
(5 6
i6 7
=>8 :
i; <
.< =
Item= A
.A B
IdB D
==E G
itemH L
.L M
IdM O
)O P
;P Q
if 
( 
existingItem  
!=! #
null$ (
)( )
await   
_repository   %
.  % &
UpdateItemQuantity  & 8
(  8 9
cartId  9 ?
,  ? @
existingItem  A M
.  M N
Item  N R
.  R S
Id  S U
,  U V
existingItem  W c
.  c d
Quantity  d l
+  m n
item  o s
.  s t
Quantity  t |
)  | }
;  } ~
else!! 
if!! 
(!! 
_repository!! $
.!!$ %

ExistsItem!!% /
(!!/ 0
item!!0 4
.!!4 5
Id!!5 7
)!!7 8
)!!8 9
await"" 
_repository"" %
.""% &
AddItemToCart""& 3
(""3 4
cartId""4 :
,"": ;
_mapper""< C
.""C D
Map""D G
<""G H
CartItemDAO""H S
>""S T
(""T U
item""U Y
)""Y Z
)""Z [
;""[ \
else## 
throw$$ 
new$$ 
ArgumentException$$ /
($$/ 0
$str$$0 F
,$$F G
nameof$$H N
($$N O
Item$$O S
)$$S T
)$$T U
;$$U V
}&& 
else'' 
throw(( 
new(( 
ArgumentException(( +
(((+ ,
$str((, A
,((A B
nameof((C I
(((I J
Item((J N
)((N O
)((O P
;((P Q
})) 	
public** 
async** 
Task** 
<** 
bool** 
>** 

ExistsCart**  *
(*** +
Guid**+ /
cartId**0 6
)**6 7
{++ 	
var,, 
cart,, 
=,, 
await,, 
_repository,, (
.,,( )
GetCart,,) 0
(,,0 1
cartId,,1 7
),,7 8
;,,8 9
return-- 
cart-- 
!=-- 
null-- 
;--  
}.. 	
public// 
async// 
Task// 
<// 
bool// 
>// 
ExistsItemOnCart//  0
(//0 1
Guid//1 5
cartId//6 <
,//< =
int//> A
itemId//B H
)//H I
{00 	
var11 
cart11 
=11 
await11 
_repository11 (
.11( )
GetCart11) 0
(110 1
cartId111 7
)117 8
;118 9
if22 
(22 
cart22 
==22 
null22 
)22 
return33 
false33 
;33 
return44 
cart44 
.44 
Items44 
.44 
Exists44 $
(44$ %
i44% &
=>44' )
i44* +
.44+ ,
Item44, 0
.440 1
Id441 3
==444 6
itemId447 =
)44= >
;44> ?
}55 	
public66 
async66 
Task66 
<66 
Cart66 
>66 
GetCart66  '
(66' (
Guid66( ,
cartId66- 3
)663 4
{77 	
var88 
cartDAO88 
=88 
await88 
_repository88  +
.88+ ,
GetCart88, 3
(883 4
cartId884 :
)88: ;
;88; <
if99 
(99 
cartDAO99 
==99 
null99 
)99  
return:: 
null:: 
;:: 
else;; 
return<< 
_mapper<< 
.<< 
Map<< "
<<<" #
Cart<<# '
><<' (
(<<( )
cartDAO<<) 0
)<<0 1
;<<1 2
}>> 	
public?? 
async?? 
Task?? 
<?? 
Cart?? 
>?? 
InitializeCart??  .
(??. /
Guid??/ 3
cartId??4 :
,??: ;
Item??< @
???@ A
item??B F
)??F G
{@@ 	
CartDAOAA 
cartDAOAA 
;AA 
ifBB 
(BB 
awaitBB 
_repositoryBB !
.BB! "

ExistsCartBB" ,
(BB, -
cartIdBB- 3
)BB3 4
)BB4 5
cartDAOCC 
=CC 
awaitCC 
_repositoryCC  +
.CC+ ,
GetCartCC, 3
(CC3 4
cartIdCC4 :
)CC: ;
;CC; <
elseDD 
cartDAOEE 
=EE 
awaitEE 
_repositoryEE  +
.EE+ ,

CreateCartEE, 6
(EE6 7
cartIdEE7 =
)EE= >
;EE> ?
ifGG 
(GG 
itemGG 
!=GG 
nullGG 
)GG 
{HH 
varII 
itemDAOII 
=II 
_mapperII %
.II% &
MapII& )
<II) *
ItemII* .
,II. /
CartItemDAOII0 ;
>II; <
(II< =
itemII= A
)IIA B
;IIB C
awaitJJ 
_repositoryJJ !
.JJ! "
AddItemToCartJJ" /
(JJ/ 0
cartIdJJ0 6
,JJ6 7
itemDAOJJ8 ?
)JJ? @
;JJ@ A
cartDAOKK 
=KK 
awaitKK 
_repositoryKK  +
.KK+ ,
GetCartKK, 3
(KK3 4
cartIdKK4 :
)KK: ;
;KK; <
}LL 
elseMM 
cartDAONN 
.NN 
ItemsNN 
=NN 
newNN  #
ListNN$ (
<NN( )
CartItemDAONN) 4
>NN4 5
(NN5 6
)NN6 7
{NN8 9
}NN: ;
;NN; <
returnPP 
_mapperPP 
.PP 
MapPP 
<PP 
CartPP #
>PP# $
(PP$ %
cartDAOPP% ,
)PP, -
;PP- .
}QQ 	
publicRR 
asyncRR 
TaskRR 

RemoveItemRR $
(RR$ %
GuidRR% )
cartIdRR* 0
,RR0 1
intRR2 5
itemIdRR6 <
)RR< =
{SS 	
awaitTT 
_repositoryTT 
.TT 
RemoveItemFromCartTT 0
(TT0 1
cartIdTT1 7
,TT7 8
itemIdTT9 ?
)TT? @
;TT@ A
}UU 	
publicVV 
asyncVV 
TaskVV 
<VV 
boolVV 
>VV 

ExistsItemVV  *
(VV* +
intVV+ .
itemIdVV/ 5
)VV5 6
{WW 	
returnXX 
awaitXX 
TaskXX 
.XX 
RunXX !
(XX! "
(XX" #
)XX# $
=>XX% '
_repositoryXX( 3
.XX3 4

ExistsItemXX4 >
(XX> ?
itemIdXX? E
)XXE F
)XXF G
;XXG H
}YY 	
publicZZ 
voidZZ 
ItemUpdatedZZ 
(ZZ  
MessagingServiceZZ  0
.ZZ0 1
	ContractsZZ1 :
.ZZ: ;
ItemZZ; ?
itemZZ@ D
)ZZD E
{[[ 	
var\\ 
itemDAO\\ 
=\\ 
_mapper\\ !
.\\! "
Map\\" %
<\\% &
ItemDAO\\& -
>\\- .
(\\. /
item\\/ 3
)\\3 4
;\\4 5
_repository]] 
.]] 
ItemUpdated]] #
(]]# $
itemDAO]]$ +
)]]+ ,
;]], -
}__ 	
public`` 
void`` 
ItemDeleted`` 
(``  
int``  #
itemId``$ *
)``* +
{aa 	
_repositorybb 
.bb 
ItemDeletedbb #
(bb# $
itemIdbb$ *
)bb* +
;bb+ ,
}cc 	
}dd 
}ee µ
[C:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CartingService\BLL\ICartingService.cs
	namespace 	
CartingService
 
. 
BLL 
{ 
public 

	interface 
ICartingService $
{ 
Task 
< 
Cart 
> 
InitializeCart !
(! "
Guid" &
cartId' -
,- .
Item/ 3
?3 4
item5 9
)9 :
;: ;
Task 
AddItem 
( 
Guid 
cartId  
,  !
Item" &
item' +
)+ ,
;, -
Task 

RemoveItem 
( 
Guid 
cartId #
,# $
int% (
itemId) /
)/ 0
;0 1
Task 
< 
Cart 
> 
GetCart 
( 
Guid 
cartId  &
)& '
;' (
Task		 
<		 
bool		 
>		 

ExistsCart		 
(		 
Guid		 "
cartId		# )
)		) *
;		* +
Task

 
<

 
bool

 
>

 
ExistsItemOnCart

 #
(

# $
Guid

$ (
cartId

) /
,

/ 0
int

1 4
itemId

5 ;
)

; <
;

< =
Task 
< 
bool 
> 

ExistsItem 
( 
int !
itemId" (
)( )
;) *
void 
ItemUpdated 
( 
MessagingService )
.) *
	Contracts* 3
.3 4
Item4 8
item9 =
)= >
;> ?
void 
ItemDeleted 
( 
int 
itemId #
)# $
;$ %
} 
} π	
PC:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CartingService\BLL\Item.cs
	namespace 	
CartingService
 
. 
BLL 
{ 
public 

class 
Item 
{ 
[ 	
Required	 
] 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[		 	
Required			 
]		 
public

 
string

 
Name

 
{

 
get

  
;

  !
set

" %
;

% &
}

' (
public 
string 
? 
Image 
{ 
get "
;" #
set$ '
;' (
}) *
[ 	
Required	 
] 
public 
decimal 
Price 
{ 
get "
;" #
set$ '
;' (
}) *
public 
double 
Quantity 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} ‚
VC:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CartingService\BLL\MQListener.cs
	namespace 	
CartingService
 
. 
BLL 
{ 
public 

class 

MQListener 
: 
BackgroundService /
{ 
private		 
readonly		 
	IMQClient		 "
	_mqClient		# ,
;		, -
private

 
readonly

  
IServiceScopeFactory

 -
_scopeFactory

. ;
;

; <
public 

MQListener 
( 
	IMQClient #
mqClient$ ,
,, - 
IServiceScopeFactory. B
scopeFactoryC O
)O P
{ 	
	_mqClient 
= 
mqClient  
;  !
_scopeFactory 
= 
scopeFactory (
;( )
} 	
	protected 
override 
Task 
ExecuteAsync  ,
(, -
CancellationToken- >
stoppingToken? L
)L M
{ 	
stoppingToken 
. (
ThrowIfCancellationRequested 6
(6 7
)7 8
;8 9
	_mqClient 
. "
SubscribeToItemUpdates ,
(, -
ProcessItemUpdate- >
)> ?
;? @
	_mqClient 
. "
SubscribeToItemDeletes ,
(, -
ProcessItemDelete- >
)> ?
;? @
return 
Task 
. 
CompletedTask %
;% &
} 	
public 
bool 
ProcessItemUpdate %
(% &
MessagingService& 6
.6 7
	Contracts7 @
.@ A
ItemA E
itemF J
)J K
{ 	
var 
result 
= 
true 
; 
using 
( 
var 
scope 
= 
_scopeFactory ,
., -
CreateScope- 8
(8 9
)9 :
): ;
{   
var!! 
cartingService!! "
=!!# $
scope!!% *
.!!* +
ServiceProvider!!+ :
.!!: ;
GetRequiredService!!; M
<!!M N
ICartingService!!N ]
>!!] ^
(!!^ _
)!!_ `
;!!` a
try"" 
{## 
cartingService$$ "
.$$" #
ItemUpdated$$# .
($$. /
item$$/ 3
)$$3 4
;$$4 5
}%% 
catch'' 
('' 
	Exception''  
)''  !
{''" #
result''$ *
=''+ ,
false''- 2
;''2 3
}''4 5
}(( 
return)) 
result)) 
;)) 
}** 	
public++ 
bool++ 
ProcessItemDelete++ %
(++% &
int++& )
itemId++* 0
)++0 1
{,, 	
var-- 
result-- 
=-- 
true-- 
;-- 
using.. 
(.. 
var.. 
scope.. 
=.. 
_scopeFactory.. ,
..., -
CreateScope..- 8
(..8 9
)..9 :
)..: ;
{// 
var00 
cartingService00 "
=00# $
scope00% *
.00* +
ServiceProvider00+ :
.00: ;
GetRequiredService00; M
<00M N
ICartingService00N ]
>00] ^
(00^ _
)00_ `
;00` a
try11 
{22 
cartingService33 "
.33" #
ItemDeleted33# .
(33. /
itemId33/ 5
)335 6
;336 7
}44 
catch66 
(66 
	Exception66  
)66  !
{66" #
result66$ *
=66+ ,
false66- 2
;662 3
}664 5
}77 
return88 
result88 
;88 
}99 	
}:: 
};; Ê
`C:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CartingService\BLL\Setup\CartingProfile.cs
	namespace 	
CartingService
 
. 
BLL 
. 
Setup "
{ 
public 

class 
CartingProfile 
:  !
Profile" )
{ 
public 
CartingProfile 
( 
) 
{		 	
	CreateMap 
< 
CartDAO 
, 
Cart #
># $
($ %
)% &
;& '
	CreateMap 
< 
Cart 
, 
CartDAO #
># $
($ %
)% &
;& '
	CreateMap 
< 
CartItemDAO !
,! "
Item# '
>' (
(( )
)) *
. 
	ForMember 
( 
i 
=> 
i  !
.! "
Id" $
,$ %
opt& )
=>* ,
opt- 0
.0 1
MapFrom1 8
(8 9
d9 :
=>; =
d> ?
.? @
Item@ D
.D E
IdE G
)G H
)H I
. 
	ForMember 
( 
i 
=> 
i  !
.! "
Name" &
,& '
opt( +
=>, .
opt/ 2
.2 3
MapFrom3 :
(: ;
d; <
=>= ?
d@ A
.A B
ItemB F
.F G
NameG K
)K L
)L M
. 
	ForMember 
( 
i 
=> 
i  !
.! "
Image" '
,' (
opt) ,
=>- /
opt0 3
.3 4
MapFrom4 ;
(; <
d< =
=>> @
dA B
.B C
ItemC G
.G H
ImageH M
)M N
)N O
. 
	ForMember 
( 
i 
=> 
i  !
.! "
Price" '
,' (
opt) ,
=>- /
opt0 3
.3 4
MapFrom4 ;
(; <
d< =
=>> @
dA B
.B C
ItemC G
.G H
PriceH M
)M N
)N O
;O P
	CreateMap 
< 
Item 
, 
CartItemDAO '
>' (
(( )
)) *
. 
	ForMember 
( 
i 
=> 
i  !
.! "
Id" $
,$ %
opt& )
=>* ,
opt- 0
.0 1
Ignore1 7
(7 8
)8 9
)9 :
. 
	ForMember 
( 
i 
=> 
i  !
.! "
Item" &
,& '
opt 
=> 
opt 
. 
MapFrom &
(& '
d' (
=>) +
new, /
ItemDAO0 7
(7 8
)8 9
{: ;
Id< >
=? @
dA B
.B C
IdC E
,E F
ImageG L
=M N
dO P
.P Q
ImageQ V
,V W
NameX \
=] ^
d_ `
.` a
Namea e
,e f
Priceg l
=m n
do p
.p q
Priceq v
}w x
)x y
)y z
;z {
	CreateMap 
< 
MessagingService &
.& '
	Contracts' 0
.0 1
Item1 5
,5 6
ItemDAO7 >
>> ?
(? @
)@ A
;A B
} 	
} 
} å
[C:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CartingService\BLL\Setup\Configure.cs
	namespace 	
CartingService
 
. 
BLL 
. 
Setup "
{ 
public		 

static		 
class		 
	Configure		 !
{

 
public 
static 
IServiceCollection (
ConfigureBLL) 5
(5 6
this6 :
IServiceCollection; M
servicesN V
)V W
{ 	
services 
. 
	AddScoped 
< 
ICartingService .
,. /
CartingRepoService0 B
>B C
(C D
)D E
;E F
services 
. 
AddAutoMapper "
(" #
Assembly# +
.+ , 
GetExecutingAssembly, @
(@ A
)A B
)B C
;C D
services 
. 
AddSingleton !
(! "
s" #
=>$ &
{ 
var 
configuration !
=" #
s$ %
.% &

GetService& 0
<0 1
IConfiguration1 ?
>? @
(@ A
)A B
;B C
var 
rabbitMQSettings $
=% &
configuration' 4
.4 5

GetSection5 ?
(? @
nameof@ F
(F G
RabbitMQSettingsG W
)W X
)X Y
.Y Z
GetZ ]
<] ^
RabbitMQSettings^ n
>n o
(o p
)p q
;q r
var 
conn 
= 
new 
ConnectionFactory 0
(0 1
)1 2
{3 4
HostName5 =
=> ?
rabbitMQSettings@ P
.P Q
HostNameQ Y
}Z [
;[ \
if 
( 
! 
( 
string 
. 
IsNullOrEmpty *
(* +
rabbitMQSettings+ ;
.; <
User< @
)@ A
||B D
stringE K
.K L
IsNullOrEmptyL Y
(Y Z
rabbitMQSettingsZ j
.j k
Passwordk s
)s t
)t u
)u v
{ 
conn 
. 
UserName !
=" #
rabbitMQSettings$ 4
.4 5
User5 9
;9 :
conn 
. 
Password !
=" #
rabbitMQSettings$ 4
.4 5
Password5 =
;= >
} 
return 
conn 
. 
CreateConnection ,
(, -
)- .
;. /
} 
) 
; 
services 
. 
AddSingleton !
<! "
	IMQClient" +
,+ ,
RabbitMQClient- ;
>; <
(< =
)= >
;> ?
services 
. 
AddHostedService %
<% &

MQListener& 0
>0 1
(1 2
)2 3
;3 4
return 
services 
; 
}   	
}!! 
}"" Ï	
\C:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CartingService\DAL\CartingDbContext.cs
	namespace 	
CartingService
 
. 
DAL 
{ 
public 

class 
CartingDbContext !
:" #
	DbContext$ -
{ 
public 
CartingDbContext 
(  
DbContextOptions  0
<0 1
CartingDbContext1 A
>A B
optionsC J
)J K
:L M
baseN R
(R S
optionsS Z
)Z [
{		 	
} 	
public 
DbSet 
< 
CartDAO 
> 
Carts #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
DbSet 
< 
CartItemDAO  
>  !
	CartItems" +
{, -
get. 1
;1 2
set3 6
;6 7
}8 9
public 
DbSet 
< 
ItemDAO 
> 
Items #
{$ %
get& )
;) *
set+ .
;. /
}0 1
} 
} È
UC:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CartingService\DAL\Configure.cs
	namespace 	
CartingService
 
. 
DAL 
{ 
public 

static 
class 
	Configure !
{		 
public

 
static

 
IServiceCollection

 (
ConfigureDAL

) 5
(

5 6
this

6 :
IServiceCollection

; M
services

N V
)

V W
{ 	
var 
config 
= 
services !
.! " 
BuildServiceProvider" 6
(6 7
)7 8
.8 9

GetService9 C
<C D
IConfigurationD R
>R S
(S T
)T U
;U V
var 
connectionString  
=! "
config# )
.) *
GetConnectionString* =
(= >
$str> I
)I J
;J K
services 
. 
	AddScoped 
< 
ILiteDatabase ,
,, -
LiteDatabase. :
>: ;
(; <
(< =
services= E
)E F
=>G I
newJ M
LiteDatabaseN Z
(Z [
connectionString[ k
)k l
)l m
;m n
services 
. 
	AddScoped 
< 
ICartingRepository 1
,1 2"
NoSQLCartingRepository3 I
>I J
(J K
)K L
;L M

BsonMapper 
. 
Global 
. 
Entity $
<$ %
CartDAO% ,
>, -
(- .
). /
./ 0
DbRef0 5
(5 6
c6 7
=>8 :
c; <
.< =
Items= B
,B C"
NoSQLCartingRepositoryD Z
.Z [
	cartitems[ d
)d e
;e f

BsonMapper 
. 
Global 
. 
Entity $
<$ %
CartItemDAO% 0
>0 1
(1 2
)2 3
.3 4
DbRef4 9
(9 :
i: ;
=>< >
i? @
.@ A
CartA E
,E F"
NoSQLCartingRepositoryG ]
.] ^
carts^ c
)c d
;d e

BsonMapper 
. 
Global 
. 
Entity $
<$ %
CartItemDAO% 0
>0 1
(1 2
)2 3
.3 4
DbRef4 9
(9 :
i: ;
=>< >
i? @
.@ A
ItemA E
,E F"
NoSQLCartingRepositoryG ]
.] ^
items^ c
)c d
;d e

BsonMapper 
. 
Global 
. 
Entity $
<$ %
CartItemDAO% 0
>0 1
(1 2
)2 3
.3 4
Id4 6
(6 7
c7 8
=>9 ;
c< =
.= >
Id> @
,@ A
trueB F
)F G
;G H
return 
services 
; 
} 	
} 
} ™
\C:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CartingService\DAL\Entities\CartDAO.cs
	namespace 	
CartingService
 
. 
DAL 
. 
Entities %
{ 
public 

class 
CartDAO 
{ 
public 
Guid 
Id 
{ 
get 
; 
set !
;! "
}# $
public 
List 
< 
CartItemDAO 
>  
Items! &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
} 
} ±
`C:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CartingService\DAL\Entities\CartItemDAO.cs
	namespace 	
CartingService
 
. 
DAL 
. 
Entities %
{ 
public 

class 
CartItemDAO 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
ItemDAO 
Item 
{ 
get !
;! "
set# &
;& '
}( )
public 
double 
Quantity 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
CartDAO 
Cart 
{ 
get !
;! "
set# &
;& '
}( )
}		 
}

 µ
\C:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CartingService\DAL\Entities\ItemDAO.cs
	namespace 	
CartingService
 
. 
DAL 
. 
Entities %
{ 
public 

class 
ItemDAO 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
? 
Image 
{ 
get "
;" #
set$ '
;' (
}) *
public 
decimal 
Price 
{ 
get "
;" #
set$ '
;' (
}) *
}		 
}

 É
^C:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CartingService\DAL\ICartingRepository.cs
	namespace 	
CartingService
 
. 
DAL 
{ 
public 

	interface 
ICartingRepository '
{ 
Task 
< 
CartDAO 
> 

CreateCart  
(  !
Guid! %
id& (
)( )
;) *
Task 
< 
CartDAO 
> 
GetCart 
( 
Guid "
id# %
)% &
;& '
Task		 
<		 
bool		 
>		 

ExistsCart		 
(		 
Guid		 "
id		# %
)		% &
;		& '
Task

 
AddItemToCart

 
(

 
Guid

 
id

  "
,

" #
CartItemDAO

$ /
item

0 4
)

4 5
;

5 6
Task 
RemoveItemFromCart 
(  
Guid  $
id% '
,' (
int) ,
itemId- 3
)3 4
;4 5
Task 
UpdateItemQuantity 
(  
Guid  $
id% '
,' (
int) ,
itemId- 3
,3 4
double5 ;
quantity< D
)D E
;E F
void 
ItemUpdated 
( 
ItemDAO  
item! %
)% &
;& '
void 
ItemDeleted 
( 
int 
itemId #
)# $
;$ %
bool 

ExistsItem 
( 
int 
itemId "
)" #
;# $
} 
} Úd
bC:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CartingService\DAL\NoSQLCartingRepository.cs
	namespace 	
CartingService
 
. 
DAL 
{ 
public 

class "
NoSQLCartingRepository '
:( )
ICartingRepository* <
{ 
private 
readonly 
ILiteDatabase &
_db' *
;* +
public		 
const		 
string		 
carts		 !
=		" #
$str		$ +
;		+ ,
public

 
const

 
string

 
items

 !
=

" #
$str

$ +
;

+ ,
public 
const 
string 
	cartitems %
=& '
$str( 3
;3 4
public "
NoSQLCartingRepository %
(% &
ILiteDatabase& 3
db4 6
)6 7
{ 	
_db 
= 
db 
; 
} 	
public 
async 
Task 
AddItemToCart '
(' (
Guid( ,
id- /
,/ 0
CartItemDAO1 <
item= A
)A B
{ 	
var 
cart 
= 
await 
GetCart $
($ %
id% '
)' (
;( )
if 
( 
cart 
== 
null 
|| 
cart  $
.$ %
Items% *
.* +
Exists+ 1
(1 2
i2 3
=>4 6
i7 8
.8 9
Item9 =
.= >
Id> @
==A C
itemD H
.H I
ItemI M
.M N
IdN P
)P Q
)Q R
return 
; 
var 
itemsCol 
= 
_db 
. 
GetCollection ,
<, -
CartItemDAO- 8
>8 9
(9 :
	cartitems: C
)C D
;D E
item 
. 
Cart 
= 
cart 
; 
await 
Task 
. 
Run 
( 
( 
) 
=>  
itemsCol! )
.) *
Upsert* 0
(0 1
item1 5
)5 6
)6 7
;7 8
item 
= 
itemsCol 
. 
Query !
(! "
)" #
. 
Where 
( 
i 
=> 
i 
. 
Item "
." #
Id# %
==& (
item) -
.- .
Item. 2
.2 3
Id3 5
&&6 8
i9 :
.: ;
Cart; ?
.? @
Id@ B
==C E
idF H
)H I
. 
FirstOrDefault 
(  
)  !
;! "
cart 
. 
Items 
. 
Add 
( 
item 
)  
;  !
var   
col   
=   
_db   
.   
GetCollection   '
<  ' (
CartDAO  ( /
>  / 0
(  0 1
carts  1 6
)  6 7
;  7 8
await!! 
Task!! 
.!! 
Run!! 
(!! 
(!! 
)!! 
=>!!  
col!!! $
.!!$ %
Update!!% +
(!!+ ,
cart!!, 0
)!!0 1
)!!1 2
;!!2 3
}"" 	
public## 
async## 
Task## 
<## 
CartDAO## !
>##! "

CreateCart### -
(##- .
Guid##. 2
id##3 5
)##5 6
{$$ 	
var%% 
cart%% 
=%% 
await%% 
GetCart%% $
(%%$ %
id%%% '
)%%' (
;%%( )
if&& 
(&& 
cart&& 
!=&& 
null&& 
)&& 
return'' 
cart'' 
;'' 
var)) 
col)) 
=)) 
_db)) 
.)) 
GetCollection)) '
<))' (
CartDAO))( /
>))/ 0
())0 1
carts))1 6
)))6 7
;))7 8
var** 
newCart** 
=** 
new** 
CartDAO** %
(**% &
)**& '
{**( )
Id*** ,
=**- .
id**/ 1
,**1 2
Items**3 8
=**9 :
new**; >
List**? C
<**C D
CartItemDAO**D O
>**O P
(**P Q
)**Q R
}**S T
;**T U
col++ 
.++ 
Insert++ 
(++ 
newCart++ 
)++ 
;++  
return,, 
newCart,, 
;,, 
}-- 	
public.. 
async.. 
Task.. 
<.. 
CartDAO.. !
>..! "
GetCart..# *
(..* +
Guid..+ /
id..0 2
)..2 3
{// 	
var00 
col00 
=00 
_db00 
.00 
GetCollection00 '
<00' (
CartDAO00( /
>00/ 0
(000 1
carts001 6
)006 7
;007 8
var11 
result11 
=11 
await11 
Task11 #
.11# $
Run11$ '
(11' (
(11( )
)11) *
=>11+ -
col11. 1
.111 2
Query112 7
(117 8
)118 9
.22, -
Include22- 4
(224 5
c225 6
=>227 9
c22: ;
.22; <
Items22< A
)22A B
.33, -
Where33- 2
(332 3
c333 4
=>335 7
c338 9
.339 :
Id33: <
==33= ?
id33@ B
)33B C
.44, -
SingleOrDefault44- <
(44< =
)44= >
)44> ?
;44? @
return55 
result55 
;55 
}66 	
public77 
async77 
Task77 
<77 
bool77 
>77 

ExistsCart77  *
(77* +
Guid77+ /
id770 2
)772 3
{88 	
var99 
cart99 
=99 
await99 
GetCart99 $
(99$ %
id99% '
)99' (
;99( )
return:: 
cart:: 
!=:: 
null:: 
;::  
};; 	
public<< 
async<< 
Task<< 
RemoveItemFromCart<< ,
(<<, -
Guid<<- 1
id<<2 4
,<<4 5
int<<6 9
itemId<<: @
)<<@ A
{== 	
var>> 
cart>> 
=>> 
await>> 
GetCart>> $
(>>$ %
id>>% '
)>>' (
;>>( )
if?? 
(?? 
cart?? 
==?? 
null?? 
||?? 
!??  !
cart??! %
.??% &
Items??& +
.??+ ,
Exists??, 2
(??2 3
i??3 4
=>??5 7
i??8 9
.??9 :
Item??: >
.??> ?
Id??? A
==??B D
itemId??E K
)??K L
)??L M
return@@ 
;@@ 
cartBB 
.BB 
ItemsBB 
.BB 
	RemoveAllBB  
(BB  !
iBB! "
=>BB# %
iBB& '
.BB' (
ItemBB( ,
.BB, -
IdBB- /
==BB0 2
itemIdBB3 9
)BB9 :
;BB: ;
varCC 
colCC 
=CC 
_dbCC 
.CC 
GetCollectionCC '
<CC' (
CartDAOCC( /
>CC/ 0
(CC0 1
cartsCC1 6
)CC6 7
;CC7 8
awaitDD 
TaskDD 
.DD 
RunDD 
(DD 
(DD 
)DD 
=>DD  
colDD! $
.DD$ %
UpdateDD% +
(DD+ ,
cartDD, 0
)DD0 1
)DD1 2
;DD2 3
}EE 	
publicFF 
asyncFF 
TaskFF 
UpdateItemQuantityFF ,
(FF, -
GuidFF- 1
idFF2 4
,FF4 5
intFF6 9
itemIdFF: @
,FF@ A
doubleFFB H
quantityFFI Q
)FFQ R
{GG 	
varHH 
cartHH 
=HH 
awaitHH 
GetCartHH $
(HH$ %
idHH% '
)HH' (
;HH( )
ifII 
(II 
cartII 
==II 
nullII 
)II 
returnJJ 
;JJ 
varLL 
itemLL 
=LL 
cartLL 
.LL 
ItemsLL !
.LL! "
FirstOrDefaultLL" 0
(LL0 1
iLL1 2
=>LL3 5
iLL6 7
.LL7 8
ItemLL8 <
.LL< =
IdLL= ?
==LL@ B
itemIdLLC I
)LLI J
;LLJ K
ifMM 
(MM 
itemMM 
==MM 
nullMM 
)MM 
returnNN 
;NN 
itemOO 
.OO 
QuantityOO 
+=OO 
quantityOO %
;OO% &
varPP 
colPP 
=PP 
_dbPP 
.PP 
GetCollectionPP '
<PP' (
CartItemDAOPP( 3
>PP3 4
(PP4 5
	cartitemsPP5 >
)PP> ?
;PP? @
awaitQQ 
TaskQQ 
.QQ 
RunQQ 
(QQ 
(QQ 
)QQ 
=>QQ  
colQQ! $
.QQ$ %
UpdateQQ% +
(QQ+ ,
itemQQ, 0
)QQ0 1
)QQ1 2
;QQ2 3
}RR 	
publicSS 
voidSS 
ItemUpdatedSS 
(SS  
ItemDAOSS  '
itemSS( ,
)SS, -
{TT 	
varUU 
colUU 
=UU 
_dbUU 
.UU 
GetCollectionUU '
<UU' (
ItemDAOUU( /
>UU/ 0
(UU0 1
itemsUU1 6
)UU6 7
;UU7 8
varVV 
itmVV 
=VV 
colVV 
.VV 
QueryVV 
(VV  
)VV  !
.VV! "
WhereVV" '
(VV' (
iVV( )
=>VV* ,
iVV- .
.VV. /
IdVV/ 1
==VV2 4
itemVV5 9
.VV9 :
IdVV: <
)VV< =
.VV= >
SingleOrDefaultVV> M
(VVM N
)VVN O
;VVO P
ifWW 
(WW 
itmWW 
==WW 
nullWW 
)WW 
{XX 
colYY 
.YY 
InsertYY 
(YY 
itemYY 
)YY  
;YY  !
}ZZ 
else[[ 
{\\ 
itm]] 
.]] 
Name]] 
=]] 
item]] 
.]]  
Name]]  $
;]]$ %
itm^^ 
.^^ 
Price^^ 
=^^ 
item^^  
.^^  !
Price^^! &
;^^& '
itm__ 
.__ 
Image__ 
=__ 
item__  
.__  !
Image__! &
;__& '
col`` 
.`` 
Update`` 
(`` 
item`` 
)``  
;``  !
}aa 
}bb 	
publiccc 
voidcc 
ItemDeletedcc 
(cc  
intcc  #
itemIdcc$ *
)cc* +
{dd 	
varee 
colee 
=ee 
_dbee 
.ee 
GetCollectionee '
<ee' (
ItemDAOee( /
>ee/ 0
(ee0 1
itemsee1 6
)ee6 7
;ee7 8
colff 
.ff 
Deleteff 
(ff 
itemIdff 
)ff 
;ff 
}gg 	
publichh 
boolhh 

ExistsItemhh 
(hh 
inthh "
itemIdhh# )
)hh) *
{ii 	
varjj 
coljj 
=jj 
_dbjj 
.jj 
GetCollectionjj '
<jj' (
ItemDAOjj( /
>jj/ 0
(jj0 1
itemsjj1 6
)jj6 7
;jj7 8
varkk 
itmkk 
=kk 
colkk 
.kk 
Querykk 
(kk  
)kk  !
.kk! "
Wherekk" '
(kk' (
ikk( )
=>kk* ,
ikk- .
.kk. /
Idkk/ 1
==kk2 4
itemIdkk5 ;
)kk; <
.kk< =
SingleOrDefaultkk= L
(kkL M
)kkM N
;kkN O
returnll 
itmll 
!=ll 
nullll 
;ll 
}mm 	
}nn 
}oo 