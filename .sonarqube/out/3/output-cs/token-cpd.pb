˘ü
\C:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CatalogService.BLL\CatalogEFService.cs
	namespace 	
CatalogService
 
. 
BLL 
{		 
public

 

class

 
CatalogEFService

 !
:

" #
ICatalogService

$ 3
{ 
private 
readonly 
DAL 
. #
CatalogServiceDbContext 4
_context5 =
;= >
private 
readonly 
IMapper  
_mapper! (
;( )
private 
readonly 
	IMQClient "
	_mqClient# ,
;, -
public 
CatalogEFService 
(  
DAL  #
.# $#
CatalogServiceDbContext$ ;
context< C
,C D
IMapperE L
mapperM S
,S T
	IMQClientU ^
mqClient_ g
)g h
{ 	
_context 
= 
context 
; 
_mapper 
= 
mapper 
; 
	_mqClient 
= 
mqClient  
;  !
} 	
public 
async 
Task 
< 
Category "
>" #
AddCategory$ /
(/ 0
CategoryDTO0 ;
categoryDTO< G
)G H
{ 	
var 
category 
= 
_mapper "
." #
Map# &
<& '
Category' /
>/ 0
(0 1
categoryDTO1 <
)< =
;= >
await 
ValidateCategory "
(" #
category# +
)+ ,
;, -
var 
categoryDAO 
= 
_mapper %
.% &
Map& )
<) *
DAL* -
.- .
Category. 6
>6 7
(7 8
category8 @
)@ A
;A B
categoryDAO 
. 
Id 
= 
$num 
; 
if 
( 
categoryDAO 
. 
Image !
==" $
null% )
)) *
categoryDAO+ 6
.6 7
Image7 <
== >
$str? A
;A B
if 
( 
categoryDAO 
. 
ParentCategoryId ,
==- /
$num0 1
&&2 4
!   
string   
.   
IsNullOrEmpty   %
(  % &
category  & .
.  . /
ParentCategory  / =
?  = >
.  > ?
Name  ? C
)  C D
)  D E
{!! 
var"" 
parentCategory"" "
=""# $
await""% *
GetCategory""+ 6
(""6 7
category""7 ?
.""? @
ParentCategory""@ N
.""N O
Name""O S
)""S T
;""T U
if## 
(## 
parentCategory## "
!=### %
null##& *
)##* +
categoryDAO$$ 
.$$  
ParentCategoryId$$  0
=$$1 2
parentCategory$$3 A
.$$A B
Id$$B D
;$$D E
}%% 
_context&& 
.&& 
Add&& 
(&& 
categoryDAO&& $
)&&$ %
;&&% &
await'' 
_context'' 
.'' 
SaveChangesAsync'' +
(''+ ,
)'', -
;''- .
return(( 
_mapper(( 
.(( 
Map(( 
<(( 
Category(( '
>((' (
(((( )
categoryDAO(() 4
)((4 5
;((5 6
})) 	
public** 
async** 
Task** 
DeleteCategory** (
(**( )
int**) ,
id**- /
)**/ 0
{++ 	
var,, 
category,, 
=,, 
await,,  
_context,,! )
.,,) *

Categories,,* 4
.-- 
Where-- "
(--" #
c--# $
=>--% '
c--( )
.--) *
Id--* ,
==--- /
id--0 2
)--2 3
... 
FirstOrDefaultAsync.. 0
(..0 1
)..1 2
;..2 3
if// 
(// 
category// 
!=// 
null//  
)//  !
{00 
var11 
items11 
=11 
await11 !
_context11" *
.11* +
Items11+ 0
.22 
Where22 
(22 
i22  
=>22! #
i22$ %
.22% &

CategoryId22& 0
==221 3
id224 6
)226 7
.33 
ToListAsync33 $
(33$ %
)33% &
;33& '
if44 
(44 
items44 
.44 
Any44 
(44 
)44 
)44  
_context55 
.55 
Remove55 #
(55# $
items55$ )
)55) *
;55* +
_context66 
.66 
Remove66 
(66  
category66  (
)66( )
;66) *
await88 
_context88 
.88 
SaveChangesAsync88 /
(88/ 0
)880 1
;881 2
}99 
}:: 	
public;; 
async;; 
Task;; 
<;; 
List;; 
<;; 
Category;; '
>;;' (
>;;( )
GetAllCategories;;* :
(;;: ;
);;; <
{<< 	
var== 

categories== 
=== 
await== "
_context==# +
.==+ ,

Categories==, 6
.==6 7
ToListAsync==7 B
(==B C
)==C D
;==D E
return>> 
_mapper>> 
.>> 
Map>> 
<>> 
List>> #
<>># $
DAL>>$ '
.>>' (
Category>>( 0
>>>0 1
,>>1 2
List>>3 7
<>>7 8
Category>>8 @
>>>@ A
>>>A B
(>>B C

categories>>C M
)>>M N
;>>N O
}?? 	
public@@ 
async@@ 
Task@@ 
<@@ 
List@@ 
<@@ 
Category@@ '
>@@' (
>@@( )
GetCategories@@* 7
(@@7 8
int@@8 ;
parentCategoryId@@< L
)@@L M
{AA 	
varBB 

categoriesBB 
=BB 
awaitBB "
_contextBB# +
.BB+ ,

CategoriesBB, 6
.CC 
WhereCC "
(CC" #
cCC# $
=>CC% '
cCC( )
.CC) *
ParentCategoryCC* 8
.CC8 9
IdCC9 ;
==CC< >
parentCategoryIdCC? O
)CCO P
.DD 
ToListAsyncDD (
(DD( )
)DD) *
;DD* +
returnEE 
_mapperEE 
.EE 
MapEE 
<EE 
ListEE #
<EE# $
DALEE$ '
.EE' (
CategoryEE( 0
>EE0 1
,EE1 2
ListEE3 7
<EE7 8
CategoryEE8 @
>EE@ A
>EEA B
(EEB C

categoriesEEC M
)EEM N
;EEN O
}FF 	
publicGG 
asyncGG 
TaskGG 
<GG 
CategoryGG "
>GG" #
GetCategoryGG$ /
(GG/ 0
intGG0 3
idGG4 6
)GG6 7
{HH 	
varII 
categoryII 
=II 
awaitII  
_contextII! )
.II) *

CategoriesII* 4
.JJ 
WhereJJ "
(JJ" #
cJJ# $
=>JJ% '
cJJ( )
.JJ) *
IdJJ* ,
==JJ- /
idJJ0 2
)JJ2 3
.KK 
IncludeKK $
(KK$ %
cKK% &
=>KK' )
cKK* +
.KK+ ,
ParentCategoryKK, :
)KK: ;
.LL 
FirstOrDefaultAsyncLL 0
(LL0 1
)LL1 2
;LL2 3
returnMM 
_mapperMM 
.MM 
MapMM 
<MM 
CategoryMM '
>MM' (
(MM( )
categoryMM) 1
)MM1 2
;MM2 3
}NN 	
publicOO 
asyncOO 
TaskOO 
<OO 
CategoryOO "
>OO" #
GetCategoryOO$ /
(OO/ 0
stringOO0 6
nameOO7 ;
)OO; <
{PP 	
varQQ 
categoryQQ 
=QQ 
awaitQQ  
_contextQQ! )
.QQ) *

CategoriesQQ* 4
.RR 
WhereRR "
(RR" #
cRR# $
=>RR% '
cRR( )
.RR) *
NameRR* .
==RR/ 1
nameRR2 6
)RR6 7
.SS 
FirstOrDefaultAsyncSS 0
(SS0 1
)SS1 2
;SS2 3
returnTT 
_mapperTT 
.TT 
MapTT 
<TT 
CategoryTT '
>TT' (
(TT( )
categoryTT) 1
)TT1 2
;TT2 3
}UU 	
publicVV 
asyncVV 
TaskVV 
UpdateCategoryVV (
(VV( )
intVV) ,
idVV- /
,VV/ 0
CategoryDTOVV1 <
categoryDTOVV= H
)VVH I
{WW 	
varXX 
categoryXX 
=XX 
_mapperXX "
.XX" #
MapXX# &
<XX& '
CategoryXX' /
>XX/ 0
(XX0 1
categoryDTOXX1 <
)XX< =
;XX= >
categoryYY 
.YY 
IdYY 
=YY 
idYY 
;YY 
ifZZ 
(ZZ 
categoryZZ 
.ZZ 
ImageZZ 
==ZZ !
nullZZ" &
)ZZ& '
categoryZZ( 0
.ZZ0 1
ImageZZ1 6
=ZZ7 8
$strZZ9 ;
;ZZ; <"
ValidateParentCategory[[ "
([[" #
category[[# +
)[[+ ,
;[[, -
var\\ 
categoryDAO\\ 
=\\ 
await\\ #
_context\\$ ,
.\\, -

Categories\\- 7
.]]$ %
Where]]% *
(]]* +
c]]+ ,
=>]]- /
c]]0 1
.]]1 2
Id]]2 4
==]]5 7
id]]8 :
)]]: ;
.^^$ %
Include^^% ,
(^^, -
c^^- .
=>^^/ 1
c^^2 3
.^^3 4
ParentCategory^^4 B
)^^B C
.__$ %
FirstOrDefaultAsync__% 8
(__8 9
)__9 :
;__: ;
if`` 
(`` 
categoryDAO`` 
==`` 
null`` #
)``# $
{aa 
throwcc 
newcc  
KeyNotFoundExceptioncc .
(cc. /
$strcc/ :
+cc; <
idcc= ?
+cc@ A
$strccB O
)ccO P
;ccP Q
}dd 
_mapperee 
.ee 
Mapee 
(ee 
categoryee  
,ee  !
categoryDAOee" -
)ee- .
;ee. /
ifff 
(ff 
categoryff 
.ff 
ParentCategoryff '
==ff( *
nullff+ /
)ff/ 0
categoryDAOgg 
.gg 
ParentCategorygg *
=gg+ ,
nullgg- 1
;gg1 2
awaithh 
_contexthh 
.hh 
SaveChangesAsynchh +
(hh+ ,
)hh, -
;hh- .
}ii 	
privatekk 
asynckk 
Taskkk 
ValidateCategorykk +
(kk+ ,
Categorykk, 4
categorykk5 =
)kk= >
{ll 	
awaitmm  
ValidateCategoryNamemm &
(mm& '
categorymm' /
.mm/ 0
Namemm0 4
)mm4 5
;mm5 6"
ValidateParentCategorynn "
(nn" #
categorynn# +
)nn+ ,
;nn, -
}oo 	
privatepp 
asyncpp 
Taskpp  
ValidateCategoryNamepp /
(pp/ 0
stringpp0 6
namepp7 ;
)pp; <
{qq 	
ifrr 
(rr 
namerr 
?rr 
.rr 
Lengthrr 
>rr 
$numrr !
)rr! "
{ss 
throwuu 
newuu 
ArgumentExceptionuu +
(uu+ ,
$struu, 2
,uu2 3
$struu4 F
)uuF G
;uuG H
}vv 
varww 
existingCategoryww  
=ww! "
awaitww# (
GetCategoryww) 4
(ww4 5
nameww5 9
)ww9 :
;ww: ;
ifxx 
(xx 
existingCategoryxx  
!=xx! #
nullxx$ (
)xx( )
{yy 
throw{{ 
new{{ 
ArgumentException{{ +
({{+ ,
$str{{, 2
,{{2 3
$str{{4 I
){{I J
;{{J K
}|| 
}}} 	
private~~ 
void~~ "
ValidateParentCategory~~ +
(~~+ ,
Category~~, 4
category~~5 =
)~~= >
{ 	
if
ÄÄ 
(
ÄÄ 
category
ÄÄ 
.
ÄÄ 
ParentCategory
ÄÄ '
!=
ÄÄ( *
null
ÄÄ+ /
)
ÄÄ/ 0
{
ÅÅ 
if
ÇÇ 
(
ÇÇ 
category
ÇÇ 
.
ÇÇ 
ParentCategory
ÇÇ +
.
ÇÇ+ ,
Id
ÇÇ, .
==
ÇÇ/ 1
$num
ÇÇ2 3
&&
ÇÇ4 6
string
ÉÉ 
.
ÉÉ 
IsNullOrEmpty
ÉÉ (
(
ÉÉ( )
category
ÉÉ) 1
.
ÉÉ1 2
ParentCategory
ÉÉ2 @
.
ÉÉ@ A
Name
ÉÉA E
)
ÉÉE F
)
ÉÉF G
{
ÑÑ 
throw
ÜÜ 
new
ÜÜ 
ArgumentException
ÜÜ /
(
ÜÜ/ 0
$str
ÜÜ0 @
,
ÜÜ@ A
$str
ÜÜB j
)
ÜÜj k
;
ÜÜk l
}
áá 
}
àà 
if
ââ 
(
ââ 
category
ââ 
.
ââ 
ParentCategory
ââ '
?
ââ' (
.
ââ( )
Name
ââ) -
==
ââ. 0
category
ââ1 9
.
ââ9 :
Name
ââ: >
||
ââ? A
(
ää 
category
ää 
.
ää 
ParentCategory
ää (
?
ää( )
.
ää) *
Id
ää* ,
==
ää- /
category
ää0 8
.
ää8 9
Id
ää9 ;
&&
ää< >
category
ää? G
.
ääG H
Id
ääH J
>
ääK L
$num
ääM N
)
ääN O
)
ääO P
{
ãã 
throw
çç 
new
çç 
ArgumentException
çç +
(
çç+ ,
$str
çç, <
,
çç< =
$str
çç> S
)
ççS T
;
ççT U
}
éé 
}
èè 	
public
ìì 
async
ìì 
Task
ìì 
<
ìì 
Item
ìì 
>
ìì 
AddItem
ìì  '
(
ìì' (
ItemDTO
ìì( /
itemDTO
ìì0 7
)
ìì7 8
{
îî 	
var
ïï 
item
ïï 
=
ïï 
_mapper
ïï 
.
ïï 
Map
ïï "
<
ïï" #
Item
ïï# '
>
ïï' (
(
ïï( )
itemDTO
ïï) 0
)
ïï0 1
;
ïï1 2
await
ññ 
ValidateItem
ññ 
(
ññ 
item
ññ #
)
ññ# $
;
ññ$ %
var
óó 
itemDAO
óó 
=
óó 
_mapper
óó !
.
óó! "
Map
óó" %
<
óó% &
DAL
óó& )
.
óó) *
Item
óó* .
>
óó. /
(
óó/ 0
item
óó0 4
)
óó4 5
;
óó5 6
itemDAO
òò 
.
òò 
Id
òò 
=
òò 
$num
òò 
;
òò 
if
ôô 
(
ôô 
itemDAO
ôô 
.
ôô 
Image
ôô 
==
ôô  
null
ôô! %
)
ôô% &
itemDAO
ôô' .
.
ôô. /
Image
ôô/ 4
=
ôô5 6
$str
ôô7 9
;
ôô9 :
_context
öö 
.
öö 
Add
öö 
(
öö 
itemDAO
öö  
)
öö  !
;
öö! "
await
õõ 
_context
õõ 
.
õõ 
SaveChangesAsync
õõ +
(
õõ+ ,
)
õõ, -
;
õõ- .
	_mqClient
úú 
.
úú  
PublishItemUpdated
úú (
(
úú( )
_mapper
úú) 0
.
úú0 1
Map
úú1 4
<
úú4 5
MessagingService
úú5 E
.
úúE F
	Contracts
úúF O
.
úúO P
Item
úúP T
>
úúT U
(
úúU V
itemDAO
úúV ]
)
úú] ^
)
úú^ _
;
úú_ `
return
ùù 
_mapper
ùù 
.
ùù 
Map
ùù 
<
ùù 
Item
ùù #
>
ùù# $
(
ùù$ %
itemDAO
ùù% ,
)
ùù, -
;
ùù- .
}
ûû 	
public
üü 
async
üü 
Task
üü 
<
üü 
List
üü 
<
üü 
Item
üü #
>
üü# $
>
üü$ %
GetAllItems
üü& 1
(
üü1 2
)
üü2 3
{
†† 	
var
°° 
items
°° 
=
°° 
await
°° 
_context
°° &
.
°°& '
Items
°°' ,
.
°°, -
ToListAsync
°°- 8
(
°°8 9
)
°°9 :
;
°°: ;
return
¢¢ 
_mapper
¢¢ 
.
¢¢ 
Map
¢¢ 
<
¢¢ 
List
¢¢ #
<
¢¢# $
Item
¢¢$ (
>
¢¢( )
>
¢¢) *
(
¢¢* +
items
¢¢+ 0
)
¢¢0 1
;
¢¢1 2
}
££ 	
public
§§ 
async
§§ 
Task
§§ 
<
§§ 
IPagedCollection
§§ *
<
§§* +
Item
§§+ /
>
§§/ 0
>
§§0 1
GetItems
§§2 :
(
§§: ;
	ItemQuery
§§; D
	itemQuery
§§E N
)
§§N O
{
•• 	
var
¶¶ 
filter
¶¶ 
=
¶¶ 
GetItemFilter
¶¶ &
(
¶¶& '
	itemQuery
¶¶' 0
)
¶¶0 1
;
¶¶1 2
var
ßß 
itemsDAL
ßß 
=
ßß 
await
ßß  
_context
ßß! )
.
ßß) *
Items
ßß* /
.
©© 
Where
©© 
(
©© 
filter
©© %
)
©©% &
.
™™ 
Include
™™  
(
™™  !
i
™™! "
=>
™™# %
i
™™& '
.
™™' (
Category
™™( 0
)
™™0 1
.
´´ $
ToPagedCollectionAsync
´´ /
(
´´/ 0
	itemQuery
´´0 9
.
´´9 :
Page
´´: >
,
´´> ?
	itemQuery
´´@ I
.
´´I J
Limit
´´J O
)
´´O P
;
´´P Q
var
≠≠ 
	itemsList
≠≠ 
=
≠≠ 
_mapper
≠≠ #
.
≠≠# $
Map
≠≠$ '
<
≠≠' (
IPagedCollection
≠≠( 8
<
≠≠8 9
DAL
≠≠9 <
.
≠≠< =
Item
≠≠= A
>
≠≠A B
,
≠≠B C
IReadOnlyList
≠≠D Q
<
≠≠Q R
Item
≠≠R V
>
≠≠V W
>
≠≠W X
(
≠≠X Y
itemsDAL
≠≠Y a
)
≠≠a b
;
≠≠b c
return
ØØ 
new
ØØ 
PagedCollection
ØØ &
<
ØØ& '
Item
ØØ' +
>
ØØ+ ,
(
ØØ, -
	itemsList
ØØ- 6
,
ØØ6 7
itemsDAL
ØØ8 @
.
ØØ@ A
	ItemCount
ØØA J
,
ØØJ K
itemsDAL
ØØL T
.
ØØT U
CurrentPageNumber
ØØU f
,
ØØf g
itemsDAL
ØØh p
.
ØØp q
PageSize
ØØq y
)
ØØy z
;
ØØz {
}
∞∞ 	
public
±± 
async
±± 
Task
±± 
<
±± 
Item
±± 
>
±± 
GetItem
±±  '
(
±±' (
string
±±( .
name
±±/ 3
)
±±3 4
{
≤≤ 	
var
≥≥ 
item
≥≥ 
=
≥≥ 
await
≥≥ 
_context
≥≥ %
.
≥≥% &
Items
≥≥& +
.
≥≥+ ,!
FirstOrDefaultAsync
≥≥, ?
(
≥≥? @
i
≥≥@ A
=>
≥≥B D
i
≥≥E F
.
≥≥F G
Name
≥≥G K
==
≥≥L N
name
≥≥O S
)
≥≥S T
;
≥≥T U
return
¥¥ 
_mapper
¥¥ 
.
¥¥ 
Map
¥¥ 
<
¥¥ 
Item
¥¥ #
>
¥¥# $
(
¥¥$ %
item
¥¥% )
)
¥¥) *
;
¥¥* +
}
µµ 	
public
∂∂ 
async
∂∂ 
Task
∂∂ 
<
∂∂ 
Item
∂∂ 
>
∂∂ 
GetItem
∂∂  '
(
∂∂' (
int
∂∂( +
id
∂∂, .
)
∂∂. /
{
∑∑ 	
var
∏∏ 
item
∏∏ 
=
∏∏ 
await
∏∏ 
_context
∏∏ %
.
∏∏% &
Items
∏∏& +
.
∏∏+ ,
	FindAsync
∏∏, 5
(
∏∏5 6
id
∏∏6 8
)
∏∏8 9
;
∏∏9 :
return
ππ 
_mapper
ππ 
.
ππ 
Map
ππ 
<
ππ 
Item
ππ #
>
ππ# $
(
ππ$ %
item
ππ% )
)
ππ) *
;
ππ* +
}
∫∫ 	
public
ªª 
async
ªª 
Task
ªª 
<
ªª 
ItemDetails
ªª %
>
ªª% &
GetItemDetails
ªª' 5
(
ªª5 6
int
ªª6 9
id
ªª: <
)
ªª< =
{
ºº 	
var
ΩΩ 
item
ΩΩ 
=
ΩΩ 
await
ΩΩ 
_context
ΩΩ %
.
ΩΩ% &
Items
ΩΩ& +
.
ΩΩ+ ,
	FindAsync
ΩΩ, 5
(
ΩΩ5 6
id
ΩΩ6 8
)
ΩΩ8 9
;
ΩΩ9 :
if
ææ 
(
ææ 
item
ææ 
==
ææ 
null
ææ 
)
ææ 
return
øø 
null
øø 
;
øø 
else
¿¿ 
{
¡¡ 
return
√√ !
GetDummyItemDetails
√√ *
(
√√* +
id
√√+ -
)
√√- .
;
√√. /
}
ƒƒ 
}
≈≈ 	
public
∆∆ 
async
∆∆ 
Task
∆∆ 

UpdateItem
∆∆ $
(
∆∆$ %
int
∆∆% (
id
∆∆) +
,
∆∆+ ,
ItemDTO
∆∆- 4
itemDTO
∆∆5 <
)
∆∆< =
{
«« 	
var
»» 
item
»» 
=
»» 
_mapper
»» 
.
»» 
Map
»» "
<
»»" #
Item
»»# '
>
»»' (
(
»»( )
itemDTO
»») 0
)
»»0 1
;
»»1 2
item
…… 
.
…… 
Id
…… 
=
…… 
id
…… 
;
…… 
if
   
(
   
item
   
.
   
Image
   
==
   
null
   "
)
  " #
item
  $ (
.
  ( )
Image
  ) .
=
  / 0
$str
  1 3
;
  3 4!
ValidateItemNumbers
ÀÀ 
(
ÀÀ  
item
ÀÀ  $
)
ÀÀ$ %
;
ÀÀ% &
await
ÃÃ "
ValidateItemCategory
ÃÃ &
(
ÃÃ& '
item
ÃÃ' +
)
ÃÃ+ ,
;
ÃÃ, -
var
ÕÕ 
itemDAO
ÕÕ 
=
ÕÕ 
await
ÕÕ 
_context
ÕÕ  (
.
ÕÕ( )
Items
ÕÕ) .
.
ÕÕ. /
	FindAsync
ÕÕ/ 8
(
ÕÕ8 9
item
ÕÕ9 =
.
ÕÕ= >
Id
ÕÕ> @
)
ÕÕ@ A
;
ÕÕA B
if
ŒŒ 
(
ŒŒ 
itemDAO
ŒŒ 
==
ŒŒ 
null
ŒŒ 
)
ŒŒ  
{
œœ 
throw
—— 
new
—— "
KeyNotFoundException
—— .
(
——. /
$str
——/ 6
+
——7 8
id
——9 ;
+
——< =
$str
——> K
)
——K L
;
——L M
}
““ 
_mapper
”” 
.
”” 
Map
”” 
(
”” 
item
”” 
,
”” 
itemDAO
”” %
)
””% &
;
””& '
await
‘‘ 
_context
‘‘ 
.
‘‘ 
SaveChangesAsync
‘‘ +
(
‘‘+ ,
)
‘‘, -
;
‘‘- .
	_mqClient
’’ 
.
’’  
PublishItemUpdated
’’ (
(
’’( )
_mapper
’’) 0
.
’’0 1
Map
’’1 4
<
’’4 5
MessagingService
’’5 E
.
’’E F
	Contracts
’’F O
.
’’O P
Item
’’P T
>
’’T U
(
’’U V
itemDAO
’’V ]
)
’’] ^
)
’’^ _
;
’’_ `
}
÷÷ 	
public
◊◊ 
async
◊◊ 
Task
◊◊ 

DeleteItem
◊◊ $
(
◊◊$ %
int
◊◊% (
id
◊◊) +
)
◊◊+ ,
{
ÿÿ 	
var
ŸŸ 
item
ŸŸ 
=
ŸŸ 
await
ŸŸ 
_context
ŸŸ %
.
ŸŸ% &
Items
ŸŸ& +
.
⁄⁄ 
Where
⁄⁄ "
(
⁄⁄" #
i
⁄⁄# $
=>
⁄⁄% '
i
⁄⁄( )
.
⁄⁄) *
Id
⁄⁄* ,
==
⁄⁄- /
id
⁄⁄0 2
)
⁄⁄2 3
.
€€ !
FirstOrDefaultAsync
€€ 0
(
€€0 1
)
€€1 2
;
€€2 3
if
‹‹ 
(
‹‹ 
item
‹‹ 
!=
‹‹ 
null
‹‹ 
)
‹‹ 
{
›› 
_context
ﬁﬁ 
.
ﬁﬁ 
Items
ﬁﬁ 
.
ﬁﬁ 
Remove
ﬁﬁ %
(
ﬁﬁ% &
item
ﬁﬁ& *
)
ﬁﬁ* +
;
ﬁﬁ+ ,
await
ﬂﬂ 
_context
ﬂﬂ 
.
ﬂﬂ 
SaveChangesAsync
ﬂﬂ /
(
ﬂﬂ/ 0
)
ﬂﬂ0 1
;
ﬂﬂ1 2
	_mqClient
‡‡ 
.
‡‡  
PublishItemDeleted
‡‡ ,
(
‡‡, -
item
‡‡- 1
.
‡‡1 2
Id
‡‡2 4
)
‡‡4 5
;
‡‡5 6
}
·· 
}
‚‚ 	
private
‰‰ 
async
‰‰ 
Task
‰‰ 
ValidateItem
‰‰ '
(
‰‰' (
Item
‰‰( ,
item
‰‰- 1
)
‰‰1 2
{
ÂÂ 	
await
ÊÊ 
ValidateItemName
ÊÊ "
(
ÊÊ" #
item
ÊÊ# '
.
ÊÊ' (
Name
ÊÊ( ,
)
ÊÊ, -
;
ÊÊ- .!
ValidateItemNumbers
ÁÁ 
(
ÁÁ  
item
ÁÁ  $
)
ÁÁ$ %
;
ÁÁ% &
await
ËË "
ValidateItemCategory
ËË &
(
ËË& '
item
ËË' +
)
ËË+ ,
;
ËË, -
}
ÈÈ 	
private
ÍÍ 
async
ÍÍ 
Task
ÍÍ 
ValidateItemName
ÍÍ +
(
ÍÍ+ ,
string
ÍÍ, 2
name
ÍÍ3 7
)
ÍÍ7 8
{
ÎÎ 	
if
ÏÏ 
(
ÏÏ 
name
ÏÏ 
?
ÏÏ 
.
ÏÏ 
Length
ÏÏ 
>
ÏÏ 
$num
ÏÏ !
)
ÏÏ! "
{
ÌÌ 
throw
ÔÔ 
new
ÔÔ 
ArgumentException
ÔÔ +
(
ÔÔ+ ,
$str
ÔÔ, 2
,
ÔÔ2 3
$str
ÔÔ4 F
)
ÔÔF G
;
ÔÔG H
}
 
var
ÚÚ 
existingItem
ÚÚ 
=
ÚÚ 
await
ÚÚ $
GetItem
ÚÚ% ,
(
ÚÚ, -
name
ÚÚ- 1
)
ÚÚ1 2
;
ÚÚ2 3
if
ÛÛ 
(
ÛÛ 
existingItem
ÛÛ 
!=
ÛÛ 
null
ÛÛ  $
)
ÛÛ$ %
{
ÙÙ 
throw
ˆˆ 
new
ˆˆ 
ArgumentException
ˆˆ +
(
ˆˆ+ ,
$str
ˆˆ, 2
,
ˆˆ2 3
$str
ˆˆ4 I
)
ˆˆI J
;
ˆˆJ K
}
˜˜ 
}
¯¯ 	
private
˘˘ 
async
˘˘ 
Task
˘˘ "
ValidateItemCategory
˘˘ /
(
˘˘/ 0
Item
˘˘0 4
item
˘˘5 9
)
˘˘9 :
{
˙˙ 	
if
˚˚ 
(
˚˚ 
item
˚˚ 
.
˚˚ 
Category
˚˚ 
==
˚˚  
null
˚˚! %
)
˚˚% &
{
¸¸ 
throw
˝˝ 
new
˝˝ 
ArgumentException
˝˝ +
(
˝˝+ ,
$str
˝˝, ;
,
˝˝; <
$str
˝˝= W
)
˝˝W X
;
˝˝X Y
}
˛˛ 
if
ˇˇ 
(
ˇˇ 
item
ˇˇ 
.
ˇˇ 
Category
ˇˇ 
.
ˇˇ 
Id
ˇˇ  
==
ˇˇ! #
$num
ˇˇ$ %
&&
ˇˇ& (
string
ÄÄ 
.
ÄÄ 
IsNullOrEmpty
ÄÄ $
(
ÄÄ$ %
item
ÄÄ% )
.
ÄÄ) *
Category
ÄÄ* 2
.
ÄÄ2 3
Name
ÄÄ3 7
)
ÄÄ7 8
)
ÄÄ8 9
{
ÅÅ 
throw
ÉÉ 
new
ÉÉ 
ArgumentException
ÉÉ +
(
ÉÉ+ ,
$str
ÉÉ, ;
,
ÉÉ; <
$str
ÉÉ= m
)
ÉÉm n
;
ÉÉn o
}
ÑÑ 
var
ÖÖ 
existingCategory
ÖÖ  
=
ÖÖ! "
await
ÖÖ# (
_context
ÖÖ) 1
.
ÖÖ1 2

Categories
ÖÖ2 <
.
ÜÜ, -
Where
ÜÜ- 2
(
ÜÜ2 3
c
ÜÜ3 4
=>
ÜÜ5 7
c
ÜÜ8 9
.
ÜÜ9 :
Id
ÜÜ: <
==
ÜÜ= ?
item
ÜÜ@ D
.
ÜÜD E
Category
ÜÜE M
.
ÜÜM N
Id
ÜÜN P
||
ÜÜQ S
c
ÜÜT U
.
ÜÜU V
Name
ÜÜV Z
==
ÜÜ[ ]
item
ÜÜ^ b
.
ÜÜb c
Category
ÜÜc k
.
ÜÜk l
Name
ÜÜl p
)
ÜÜp q
.
áá, -!
FirstOrDefaultAsync
áá- @
(
áá@ A
)
ááA B
;
ááB C
if
àà 
(
àà 
existingCategory
àà  
==
àà! #
null
àà$ (
)
àà( )
{
ââ 
throw
ää 
new
ää 
ArgumentException
ää +
(
ää+ ,
$str
ää, ;
,
ää; <
$str
ää= W
)
ääW X
;
ääX Y
}
ãã 
}
åå 	
private
çç 
void
çç !
ValidateItemNumbers
çç (
(
çç( )
Item
çç) -
item
çç. 2
)
çç2 3
{
éé 	
if
èè 
(
èè 
!
èè 
(
èè 
item
èè 
.
èè 
Price
èè 
>=
èè 
$num
èè  !
)
èè! "
)
èè" #
{
êê 
throw
ëë 
new
ëë 
ArgumentException
ëë +
(
ëë+ ,
$str
ëë, 3
,
ëë3 4
$str
ëë5 M
)
ëëM N
;
ëëN O
}
íí 
if
ìì 
(
ìì 
!
ìì 
(
ìì 
item
ìì 
.
ìì 
Amount
ìì 
>=
ìì  
$num
ìì! "
)
ìì" #
)
ìì# $
{
îî 
throw
ïï 
new
ïï 
ArgumentException
ïï +
(
ïï+ ,
$str
ïï, 4
,
ïï4 5
$str
ïï6 O
)
ïïO P
;
ïïP Q
}
ññ 
}
óó 	
private
òò 

Expression
òò 
<
òò 
Func
òò 
<
òò  
DAL
òò  #
.
òò# $
Item
òò$ (
,
òò( )
bool
òò* .
>
òò. /
>
òò/ 0
GetItemFilter
òò1 >
(
òò> ?
	ItemQuery
òò? H
	itemQuery
òòI R
)
òòR S
{
ôô 	
var
öö 
filterConstant
öö 
=
öö  

Expression
öö! +
.
öö+ ,
Constant
öö, 4
(
öö4 5
true
öö5 9
)
öö9 :
;
öö: ;

Expression
õõ 
<
õõ 
Func
õõ 
<
õõ 
DAL
õõ 
.
õõ  
Item
õõ  $
,
õõ$ %
bool
õõ& *
>
õõ* +
>
õõ+ ,
filter
õõ- 3
=
õõ4 5
i
õõ6 7
=>
õõ8 :
i
õõ; <
.
õõ< =

CategoryId
õõ= G
==
õõH J
	itemQuery
õõK T
.
õõT U

CategoryId
õõU _
;
õõ_ `
if
úú 
(
úú 
	itemQuery
úú 
.
úú 
PriceMax
úú "
.
úú" #
HasValue
úú# +
)
úú+ ,
{
ùù 

Expression
ûû 
<
ûû 
Func
ûû 
<
ûû  
DAL
ûû  #
.
ûû# $
Item
ûû$ (
,
ûû( )
bool
ûû* .
>
ûû. /
>
ûû/ 0
priceMaxFilter
ûû1 ?
=
ûû@ A
i
ûûB C
=>
ûûD F
i
ûûG H
.
ûûH I
Price
ûûI N
<=
ûûO Q
	itemQuery
ûûR [
.
ûû[ \
PriceMax
ûû\ d
;
ûûd e
var
üü 
invokedExpr
üü 
=
üü  !

Expression
üü" ,
.
üü, -
Invoke
üü- 3
(
üü3 4
priceMaxFilter
üü4 B
,
üüB C
filter
üüD J
.
üüJ K

Parameters
üüK U
.
üüU V
Cast
üüV Z
<
üüZ [

Expression
üü[ e
>
üüe f
(
üüf g
)
üüg h
)
üüh i
;
üüi j
filter
°° 
=
°° 

Expression
°° #
.
°°# $
Lambda
°°$ *
<
°°* +
Func
°°+ /
<
°°/ 0
DAL
°°0 3
.
°°3 4
Item
°°4 8
,
°°8 9
bool
°°: >
>
°°> ?
>
°°? @
(
°°@ A

Expression
¢¢ &
.
¢¢& '
AndAlso
¢¢' .
(
¢¢. /
filter
¢¢/ 5
.
¢¢5 6
Body
¢¢6 :
,
¢¢: ;
invokedExpr
¢¢< G
)
¢¢G H
,
¢¢H I
filter
¢¢J P
.
¢¢P Q

Parameters
¢¢Q [
)
¢¢[ \
;
¢¢\ ]
}
££ 
if
§§ 
(
§§ 
	itemQuery
§§ 
.
§§ 
PriceMin
§§ "
.
§§" #
HasValue
§§# +
)
§§+ ,
{
•• 

Expression
¶¶ 
<
¶¶ 
Func
¶¶ 
<
¶¶  
DAL
¶¶  #
.
¶¶# $
Item
¶¶$ (
,
¶¶( )
bool
¶¶* .
>
¶¶. /
>
¶¶/ 0
priceMinFilter
¶¶1 ?
=
¶¶@ A
i
¶¶B C
=>
¶¶D F
i
¶¶G H
.
¶¶H I
Price
¶¶I N
>=
¶¶O Q
	itemQuery
¶¶R [
.
¶¶[ \
PriceMin
¶¶\ d
;
¶¶d e
var
ßß 
invokedExpr
ßß 
=
ßß  !

Expression
ßß" ,
.
ßß, -
Invoke
ßß- 3
(
ßß3 4
priceMinFilter
ßß4 B
,
ßßB C
filter
ßßD J
.
ßßJ K

Parameters
ßßK U
.
ßßU V
Cast
ßßV Z
<
ßßZ [

Expression
ßß[ e
>
ßße f
(
ßßf g
)
ßßg h
)
ßßh i
;
ßßi j
filter
©© 
=
©© 

Expression
©© #
.
©©# $
Lambda
©©$ *
<
©©* +
Func
©©+ /
<
©©/ 0
DAL
©©0 3
.
©©3 4
Item
©©4 8
,
©©8 9
bool
©©: >
>
©©> ?
>
©©? @
(
©©@ A

Expression
™™ &
.
™™& '
AndAlso
™™' .
(
™™. /
filter
™™/ 5
.
™™5 6
Body
™™6 :
,
™™: ;
invokedExpr
™™< G
)
™™G H
,
™™H I
filter
™™J P
.
™™P Q

Parameters
™™Q [
)
™™[ \
;
™™\ ]
}
´´ 
return
≠≠ 
filter
≠≠ 
;
≠≠ 
}
ØØ 	
private
∞∞ 
ItemDetails
∞∞ !
GetDummyItemDetails
∞∞ /
(
∞∞/ 0
int
∞∞0 3
id
∞∞4 6
)
∞∞6 7
{
±± 	
var
≤≤ 
itemDetails
≤≤ 
=
≤≤ 
new
≤≤ !
ItemDetails
≤≤" -
(
≤≤- .
)
≤≤. /
{
≤≤0 1
ItemId
≤≤2 8
=
≤≤9 :
id
≤≤; =
}
≤≤> ?
;
≤≤? @
itemDetails
≥≥ 
.
≥≥ 
Details
≥≥ 
=
≥≥  !&
GetItemDetailsDictionary
≥≥" :
(
≥≥: ;
id
≥≥; =
)
≥≥= >
;
≥≥> ?
return
¥¥ 
itemDetails
¥¥ 
;
¥¥ 
}
µµ 	
private
∂∂ 

Dictionary
∂∂ 
<
∂∂ 
string
∂∂ !
,
∂∂! "
string
∂∂# )
>
∂∂) *&
GetItemDetailsDictionary
∂∂+ C
(
∂∂C D
int
∂∂D G
id
∂∂H J
)
∂∂J K
{
∑∑ 	
var
∏∏ 
details
∏∏ 
=
∏∏ 
new
∏∏ 

Dictionary
∏∏ (
<
∏∏( )
string
∏∏) /
,
∏∏/ 0
string
∏∏1 7
>
∏∏7 8
(
∏∏8 9
)
∏∏9 :
;
∏∏: ;
details
ππ 
[
ππ 
$str
ππ 
]
ππ 
=
ππ 
$str
ππ '
;
ππ' (
details
∫∫ 
[
∫∫ 
$str
∫∫ 
]
∫∫ 
=
∫∫ 
$str
∫∫ (
;
∫∫( )
return
ªª 
details
ªª 
;
ªª 
}
ºº 	
}
ææ 
}øø ≤
]C:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CatalogService.BLL\Entities\Category.cs
	namespace 	
CatalogService
 
. 
BLL 
. 
Entities %
{ 
public 

class 
Category 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
Image 
{ 
get !
;! "
set# &
;& '
}( )
public 
Category 
ParentCategory &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
}		 
}

 ‹
`C:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CatalogService.BLL\Entities\CategoryDTO.cs
	namespace 	
CatalogService
 
. 
BLL 
. 
Entities %
{ 
public 

class 
CategoryDTO 
{		 
[

 	
Required

	 
]

 
[ 	
StringLength	 
( 
$num 
) 
] 
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
? 
Image 
{ 
get "
;" #
set$ '
;' (
}) *
public 
int 
? 
ParentCategoryId $
{% &
get' *
;* +
set, /
;/ 0
}1 2
} 
} Ù

YC:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CatalogService.BLL\Entities\Item.cs
	namespace 	
CatalogService
 
. 
BLL 
. 
Entities %
{ 
public 

class 
Item 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
Description !
{" #
get$ '
;' (
set) ,
;, -
}. /
public

 
string

 
Image

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
public 
Category 
Category  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
decimal 
Price 
{ 
get "
;" #
set$ '
;' (
}) *
public 
int 
Amount 
{ 
get 
;  
set! $
;$ %
}& '
} 
} ï
`C:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CatalogService.BLL\Entities\ItemDetails.cs
	namespace 	
CatalogService
 
. 
BLL 
. 
Entities %
{ 
public 

class 
ItemDetails 
{ 
public 
int 
ItemId 
{ 
get 
;  
set! $
;$ %
}& '
public 

Dictionary 
< 
string  
,  !
string" (
>( )
Details* 1
{2 3
get4 7
;7 8
set9 <
;< =
}> ?
=@ A
newB E

DictionaryF P
<P Q
stringQ W
,W X
stringY _
>_ `
(` a
)a b
;b c
} 
} º
\C:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CatalogService.BLL\Entities\ItemDTO.cs
	namespace 	
CatalogService
 
. 
BLL 
. 
Entities %
{ 
public 

class 
ItemDTO 
{ 
[ 	
Required	 
] 
[ 	
StringLength	 
( 
$num 
) 
] 
public		 
string		 
Name		 
{		 
get		  
;		  !
set		" %
;		% &
}		' (
public 
string 
? 
Description "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 
? 
Image 
{ 
get "
;" #
set$ '
;' (
}) *
[ 	
Required	 
] 
public 
int 

CategoryId 
{ 
get  #
;# $
set% (
;( )
}* +
[ 	
Required	 
] 
[ 	
Range	 
( 
$num 
, 
( 
double 
) 
decimal !
.! "
MaxValue" *
)* +
]+ ,
public 
decimal 
Price 
{ 
get "
;" #
set$ '
;' (
}) *
[ 	
Required	 
] 
[ 	
Range	 
( 
$num 
, 
int 
. 
MaxValue 
) 
]  
public 
int 
Amount 
{ 
get 
;  
set! $
;$ %
}& '
} 
} ñ
^C:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CatalogService.BLL\Entities\ItemQuery.cs
	namespace 	
CatalogService
 
. 
BLL 
. 
Entities %
{ 
public 

class 
	ItemQuery 
{ 
private 
const 
int 
DEFAULT_PAGE_NUMBER -
=. /
$num0 1
;1 2
private 
const 
int 
DEFAULT_PAGE_SIZE +
=, -
$num. 0
;0 1
[

 	
	FromQuery

	 
(

 
Name

 
=

 
$str

  
)

  !
]

! "
public 
int 
Page 
{ 
get 
; 
set "
;" #
}$ %
=& '
DEFAULT_PAGE_NUMBER( ;
;; <
[ 	
	FromQuery	 
( 
Name 
= 
$str !
)! "
]" #
public 
int 
Limit 
{ 
get 
; 
set  #
;# $
}% &
=' (
DEFAULT_PAGE_SIZE) :
;: ;
[ 	
	FromQuery	 
( 
Name 
= 
$str &
)& '
]' (
public 
int 

CategoryId 
{ 
get  #
;# $
set% (
;( )
}* +
[ 	
	FromQuery	 
( 
Name 
= 
$str $
)$ %
]% &
public 
decimal 
? 
PriceMin  
{! "
get# &
;& '
set( +
;+ ,
}- .
[ 	
	FromQuery	 
( 
Name 
= 
$str $
)$ %
]% &
public 
decimal 
? 
PriceMax  
{! "
get# &
;& '
set( +
;+ ,
}- .
} 
} π
kC:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CatalogService.BLL\Extensions\IQueryableExtensions.cs
	namespace 	
CatalogService
 
. 
BLL 
. 

Extensions '
{ 
public 

static 
class  
IQueryableExtensions ,
{ 
public 
static 
Task 
< 
PagedCollection *
<* +
T+ ,
>, -
>- ."
ToPagedCollectionAsync/ E
<E F
TF G
>G H
(H I
this 

IQueryable 
< 
T 
> 
source %
,% &
int		 

pageNumber		 
,		 
int

 
pageSize

 
)

 
{ 	
if 
( 
source 
== 
null 
) 
throw 
new !
ArgumentNullException /
(/ 0
nameof0 6
(6 7
source7 =
)= >
,> ?
$str@ W
)W X
;X Y
if 
( 

pageNumber 
< 
$num 
) 
throw 
new '
ArgumentOutOfRangeException 5
(5 6
nameof6 <
(< =

pageNumber= G
)G H
,H I
$strJ w
)w x
;x y
if 
( 
pageSize 
< 
$num 
) 
throw 
new '
ArgumentOutOfRangeException 5
(5 6
nameof6 <
(< =
pageSize= E
)E F
,F G
$strH u
)u v
;v w
async 
Task 
< 
PagedCollection &
<& '
T' (
>( )
>) *"
ToPagedCollectionAsync+ A
(A B
)B C
{ 
var 
	itemCount 
= 
await  %
source& ,
., -

CountAsync- 7
(7 8
)8 9
;9 :
var 
items 
= 
await !
source" (
. 
Skip 
( 
pageSize "
*# $
(% &

pageNumber& 0
-1 2
$num3 4
)4 5
)5 6
. 
Take 
( 
pageSize "
)" #
. 
ToListAsync  
(  !
)! "
;" #
return   
new   
PagedCollection   *
<  * +
T  + ,
>  , -
(  - .
items  . 3
,  3 4
	itemCount  5 >
,  > ?

pageNumber  @ J
,  J K
pageSize  L T
)  T U
;  U V
}!! 
return## "
ToPagedCollectionAsync## )
(##) *
)##* +
;##+ ,
}$$ 	
}%% 
}&& ÷
cC:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CatalogService.BLL\GraphQL\CatalogMutation.cs
	namespace 	
CatalogService
 
. 
BLL 
. 
GraphQL $
{ 
public 

class 
CatalogMutation  
{ 
} 
} ®V
gC:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CatalogService.BLL\GraphQL\CatalogMutationType.cs
	namespace 	
CatalogService
 
. 
BLL 
. 
GraphQL $
{ 
public 

class 
CatalogMutationType $
:% &

ObjectType' 1
<1 2
CatalogMutation2 A
>A B
{ 
	protected 
override 
void 
	Configure  )
() *!
IObjectTypeDescriptor* ?
<? @
CatalogMutation@ O
>O P

descriptorQ [
)[ \
{ 	
base		 
.		 
	Configure		 
(		 

descriptor		 %
)		% &
;		& '

descriptor

 
.

 
Field

 
(

 
$str

 *
)

* +
. 
Argument 
( 
$str $
,$ %
a& '
=>( *
a+ ,
., -
Type- 1
<1 2
CategoryInputType2 C
>C D
(D E
)E F
)F G
. 
Type 
< 
CategoryType "
>" #
(# $
)$ %
. 
Resolve 
( 
async 
context &
=>' )
{ 
var 
category  
=! "
context# *
.* +
ArgumentValue+ 8
<8 9
CategoryDTO9 D
>D E
(E F
$strF P
)P Q
;Q R
var 
catalog 
=  !
context" )
.) *
Service* 1
<1 2
ICatalogService2 A
>A B
(B C
)C D
;D E
var 
newCat 
=  
await! &
catalog' .
.. /
AddCategory/ :
(: ;
category; C
)C D
;D E
return 
await  
catalog! (
.( )
GetCategory) 4
(4 5
newCat5 ;
.; <
Id< >
)> ?
;? @
} 
) 
. 
Error 
< 
ArgumentException (
>( )
() *
)* +
;+ ,

descriptor 
. 
Field 
( 
$str -
)- .
. 
Argument 
( 
$str $
,$ %
a& '
=>( *
a+ ,
., -
Type- 1
<1 2
CategoryInputType2 C
>C D
(D E
)E F
)F G
. 
Argument 
( 
$str 
, 
a  !
=>" $
a% &
.& '
Type' +
<+ ,
IntType, 3
>3 4
(4 5
)5 6
)6 7
. 
Type 
< 
CategoryType "
>" #
(# $
)$ %
. 
Resolve 
( 
async 
context &
=>' )
{ 
var 
category  
=! "
context# *
.* +
ArgumentValue+ 8
<8 9
CategoryDTO9 D
>D E
(E F
$strF P
)P Q
;Q R
var 

categoryId "
=# $
context% ,
., -
ArgumentValue- :
<: ;
int; >
>> ?
(? @
$str@ D
)D E
;E F
var 
catalog 
=  !
context" )
.) *
Service* 1
<1 2
ICatalogService2 A
>A B
(B C
)C D
;D E
await 
catalog !
.! "
UpdateCategory" 0
(0 1

categoryId1 ;
,; <
category= E
)E F
;F G
return   
await    
catalog  ! (
.  ( )
GetCategory  ) 4
(  4 5

categoryId  5 ?
)  ? @
;  @ A
}!! 
)!! 
."" 
Error"" 
<"" 
ArgumentException"" (
>""( )
("") *
)""* +
.## 
Error## 
<##  
KeyNotFoundException## +
>##+ ,
(##, -
)##- .
;##. /

descriptor%% 
.%% 
Field%% 
(%% 
$str%% -
)%%- .
.&& 
Argument&& 
(&& 
$str&& 
,&& 
a&&  !
=>&&" $
a&&% &
.&&& '
Type&&' +
<&&+ ,
IntType&&, 3
>&&3 4
(&&4 5
)&&5 6
)&&6 7
.'' 
Type'' 
<'' 
BooleanType'' !
>''! "
(''" #
)''# $
.(( 
Resolve(( 
((( 
async(( 
context(( &
=>((' )
{)) 
var** 

categoryId** "
=**# $
context**% ,
.**, -
ArgumentValue**- :
<**: ;
int**; >
>**> ?
(**? @
$str**@ D
)**D E
;**E F
var++ 
catalog++ 
=++  !
context++" )
.++) *
Service++* 1
<++1 2
ICatalogService++2 A
>++A B
(++B C
)++C D
;++D E
await,, 
catalog,, !
.,,! "
DeleteCategory,," 0
(,,0 1

categoryId,,1 ;
),,; <
;,,< =
return-- 
true-- 
;--  
}.. 
).. 
;.. 

descriptor00 
.00 
Field00 
(00 
$str00 &
)00& '
.11 
Argument11 
(11 
$str11  
,11  !
a11" #
=>11$ &
a11' (
.11( )
Type11) -
<11- .
ItemInputType11. ;
>11; <
(11< =
)11= >
)11> ?
.22 
Type22 
<22 
ItemType22 
>22 
(22  
)22  !
.33 
Resolve33 
(33 
async33 
context33 &
=>33' )
{44 
var55 
item55 
=55 
context55 &
.55& '
ArgumentValue55' 4
<554 5
ItemDTO555 <
>55< =
(55= >
$str55> D
)55D E
;55E F
var66 
catalog66 
=66  !
context66" )
.66) *
Service66* 1
<661 2
ICatalogService662 A
>66A B
(66B C
)66C D
;66D E
return77 
await77  
catalog77! (
.77( )
AddItem77) 0
(770 1
item771 5
)775 6
;776 7
}88 
)88 
.99 
Error99 
<99 
ArgumentException99 (
>99( )
(99) *
)99* +
;99+ ,

descriptor;; 
.;; 
Field;; 
(;; 
$str;; )
);;) *
.<< 
Argument<< 
(<< 
$str<<  
,<<  !
a<<" #
=><<$ &
a<<' (
.<<( )
Type<<) -
<<<- .
ItemInputType<<. ;
><<; <
(<<< =
)<<= >
)<<> ?
.== 
Argument== 
(== 
$str== 
,== 
a==  !
=>==" $
a==% &
.==& '
Type==' +
<==+ ,
IntType==, 3
>==3 4
(==4 5
)==5 6
)==6 7
.>> 
Type>> 
<>> 
ItemType>> 
>>> 
(>>  
)>>  !
.?? 
Resolve?? 
(?? 
async?? 
context?? &
=>??' )
{@@ 
varAA 
itemAA 
=AA 
contextAA &
.AA& '
ArgumentValueAA' 4
<AA4 5
ItemDTOAA5 <
>AA< =
(AA= >
$strAA> D
)AAD E
;AAE F
varBB 
idBB 
=BB 
contextBB $
.BB$ %
ArgumentValueBB% 2
<BB2 3
intBB3 6
>BB6 7
(BB7 8
$strBB8 <
)BB< =
;BB= >
varCC 
catalogCC 
=CC  !
contextCC" )
.CC) *
ServiceCC* 1
<CC1 2
ICatalogServiceCC2 A
>CCA B
(CCB C
)CCC D
;CCD E
awaitDD 
catalogDD !
.DD! "

UpdateItemDD" ,
(DD, -
idDD- /
,DD/ 0
itemDD1 5
)DD5 6
;DD6 7
returnEE 
awaitEE  
catalogEE! (
.EE( )
GetItemEE) 0
(EE0 1
idEE1 3
)EE3 4
;EE4 5
}FF 
)FF 
.GG 
ErrorGG 
<GG 
ArgumentExceptionGG (
>GG( )
(GG) *
)GG* +
.HH 
ErrorHH 
<HH  
KeyNotFoundExceptionHH +
>HH+ ,
(HH, -
)HH- .
;HH. /

descriptorJJ 
.JJ 
FieldJJ 
(JJ 
$strJJ )
)JJ) *
.KK 
ArgumentKK 
(KK 
$strKK 
,KK 
aKK  !
=>KK" $
aKK% &
.KK& '
TypeKK' +
<KK+ ,
IntTypeKK, 3
>KK3 4
(KK4 5
)KK5 6
)KK6 7
.LL 
TypeLL 
<LL 
BooleanTypeLL !
>LL! "
(LL" #
)LL# $
.MM 
ResolveMM 
(MM 
asyncMM 
contextMM &
=>MM' )
{NN 
varOO 
idOO 
=OO 
contextOO $
.OO$ %
ArgumentValueOO% 2
<OO2 3
intOO3 6
>OO6 7
(OO7 8
$strOO8 <
)OO< =
;OO= >
varPP 
catalogPP 
=PP  !
contextPP" )
.PP) *
ServicePP* 1
<PP1 2
ICatalogServicePP2 A
>PPA B
(PPB C
)PPC D
;PPD E
awaitQQ 
catalogQQ !
.QQ! "

DeleteItemQQ" ,
(QQ, -
idQQ- /
)QQ/ 0
;QQ0 1
returnRR 
trueRR 
;RR  
}SS 
)SS 
.TT 
ErrorTT 
<TT 
ArgumentExceptionTT (
>TT( )
(TT) *
)TT* +
.UU 
ErrorUU 
<UU  
KeyNotFoundExceptionUU +
>UU+ ,
(UU, -
)UU- .
;UU. /
}WW 	
}XX 
}YY ˛
`C:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CatalogService.BLL\GraphQL\CatalogQuery.cs
	namespace 	
CatalogService
 
. 
BLL 
. 
GraphQL $
{ 
public 

class 
CatalogQuery 
{ 
public 
async 
Task 
< 
IList 
<  
Category  (
>( )
>) *
GetCategories+ 8
(8 9
[9 :
Service: A
]A B
ICatalogServiceC R
catalogS Z
)Z [
=>		 
await		 
catalog		 
.		 
GetAllCategories		 -
(		- .
)		. /
;		/ 0
[ 	
	UsePaging	 
] 
public 
async 
Task 
< 
IEnumerable %
<% &
Item& *
>* +
>+ ,
GetItemsDPaging- <
(< =
[= >
Service> E
]E F
ICatalogServiceG V
catalogW ^
,^ _
int` c

categoryIdd n
)n o
{ 	
return 
await 
catalog  
.  !
GetItems! )
() *
new* -
	ItemQuery. 7
(7 8
)8 9
{: ;

CategoryId< F
=G H

categoryIdI S
,S T
PageU Y
=Z [
$num\ ]
,] ^
Limit_ d
=e f
intg j
.j k
MaxValuek s
}t u
)u v
;v w
} 	
public 
async 
Task 
< 
IEnumerable %
<% &
Item& *
>* +
>+ ,
GetItemsCPaging- <
(< =
[= >
Service> E
]E F
ICatalogServiceG V
catalogW ^
,^ _
int` c

categoryIdd n
,n o
intp s
paget x
,x y
intz }
pageSize	~ Ü
)
Ü á
{ 	
return 
await 
catalog  
.  !
GetItems! )
() *
new* -
	ItemQuery. 7
(7 8
)8 9
{: ;

CategoryId< F
=G H

categoryIdI S
,S T
PageU Y
=Z [
page\ `
,` a
Limitb g
=h i
pageSizej r
}s t
)t u
;u v
} 	
} 
} π
dC:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CatalogService.BLL\GraphQL\CatalogQueryType.cs
	namespace 	
CatalogService
 
. 
BLL 
. 
GraphQL $
{ 
public 

class 
CatalogQueryType !
:" #

ObjectType$ .
<. /
CatalogQuery/ ;
>; <
{ 
	protected 
override 
void 
	Configure  )
() *!
IObjectTypeDescriptor* ?
<? @
CatalogQuery@ L
>L M

descriptorN X
)X Y
{ 	
base 
. 
	Configure 
( 

descriptor %
)% &
;& '
} 	
}		 
}

 ’
eC:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CatalogService.BLL\GraphQL\CategoryInputType.cs
	namespace 	
CatalogService
 
. 
BLL 
. 
GraphQL $
{ 
public 

class 
CategoryInputType "
:# $
InputObjectType% 4
<4 5
CategoryDTO5 @
>@ A
{ 
	protected 
override 
void 
	Configure  )
() *&
IInputObjectTypeDescriptor* D
<D E
CategoryDTOE P
>P Q

descriptorR \
)\ ]
{		 	

descriptor

 
.

  
BindFieldsExplicitly

 +
(

+ ,
)

, -
;

- .

descriptor 
. 
Name 
( 
$str +
)+ ,
;, -

descriptor 
. 
Field 
( 
f 
=> !
f" #
.# $
Name$ (
)( )
;) *

descriptor 
. 
Field 
( 
f 
=> !
f" #
.# $
ParentCategoryId$ 4
)4 5
. 
Type 
< 
NonNullType !
<! "
IntType" )
>) *
>* +
(+ ,
), -
;- .
} 	
} 
} ∏
`C:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CatalogService.BLL\GraphQL\CategoryType.cs
	namespace 	
CatalogService
 
. 
BLL 
. 
GraphQL $
{ 
public 

class 
CategoryType 
: 

ObjectType  *
<* +
Category+ 3
>3 4
{ 
	protected 
override 
void 
	Configure  )
() *!
IObjectTypeDescriptor* ?
<? @
Category@ H
>H I

descriptorJ T
)T U
{ 	

descriptor		 
.		  
BindFieldsExplicitly		 +
(		+ ,
)		, -
;		- .

descriptor

 
.

 
Field

 
(

 
f

 
=>

 !
f

" #
.

# $
Id

$ &
)

& '
;

' (

descriptor 
. 
Field 
( 
f 
=> !
f" #
.# $
Name$ (
)( )
. 
Type 
< 

StringType  
>  !
(! "
)" #
;# $

descriptor 
. 
Field 
( 
f 
=> !
f" #
.# $
ParentCategory$ 2
)2 3
. 
Type 
< 
CategoryType "
>" #
(# $
)$ %
;% &
} 	
} 
} ¬
aC:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CatalogService.BLL\GraphQL\ItemInputType.cs
	namespace 	
CatalogService
 
. 
BLL 
. 
GraphQL $
{ 
public 

class 
ItemInputType 
:  
InputObjectType! 0
<0 1
ItemDTO1 8
>8 9
{ 
	protected 
override 
void 
	Configure  )
() *&
IInputObjectTypeDescriptor* D
<D E
ItemDTOE L
>L M

descriptorN X
)X Y
{ 	

descriptor		 
.		  
BindFieldsExplicitly		 +
(		+ ,
)		, -
;		- .

descriptor

 
.

 
Name

 
(

 
$str

 '
)

' (
;

( )

descriptor 
. 
Field 
( 
f 
=> !
f" #
.# $
Name$ (
)( )
;) *

descriptor 
. 
Field 
( 
f 
=> !
f" #
.# $
Description$ /
)/ 0
;0 1

descriptor 
. 
Field 
( 
f 
=> !
f" #
.# $

CategoryId$ .
). /
;/ 0

descriptor 
. 
Field 
( 
f 
=> !
f" #
.# $
Price$ )
)) *
;* +

descriptor 
. 
Field 
( 
f 
=> !
f" #
.# $
Amount$ *
)* +
;+ ,
} 	
} 
} œ
\C:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CatalogService.BLL\GraphQL\ItemType.cs
	namespace 	
CatalogService
 
. 
BLL 
. 
GraphQL $
{ 
public 

class 
ItemType 
: 

ObjectType &
<& '
Item' +
>+ ,
{ 
	protected 
override 
void 
	Configure  )
() *!
IObjectTypeDescriptor* ?
<? @
Item@ D
>D E

descriptorF P
)P Q
{ 	

descriptor		 
.		  
BindFieldsExplicitly		 +
(		+ ,
)		, -
;		- .

descriptor

 
.

 
Field

 
(

 
f

 
=>

 !
f

" #
.

# $
Id

$ &
)

& '
;

' (

descriptor 
. 
Field 
( 
f 
=> !
f" #
.# $
Name$ (
)( )
;) *

descriptor 
. 
Field 
( 
f 
=> !
f" #
.# $
Description$ /
)/ 0
;0 1

descriptor 
. 
Field 
( 
f 
=> !
f" #
.# $
Category$ ,
), -
. 
Type 
< 
CategoryType "
>" #
(# $
)$ %
;% &

descriptor 
. 
Field 
( 
f 
=> !
f" #
.# $
Price$ )
)) *
. 
Type 
< 
DecimalType !
>! "
(" #
)# $
;$ %

descriptor 
. 
Field 
( 
f 
=> !
f" #
.# $
Amount$ *
)* +
;+ ,
} 	
} 
} Ø
[C:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CatalogService.BLL\ICatalogService.cs
	namespace 	
CatalogService
 
. 
BLL 
{ 
public 

	interface 
ICatalogService $
{ 
Task 
< 
Category 
> 
AddCategory "
(" #
CategoryDTO# .
categoryDTO/ :
): ;
;; <
Task		 
<		 
List		 
<		 
Category		 
>		 
>		 
GetAllCategories		 -
(		- .
)		. /
;		/ 0
Task

 
<

 
List

 
<

 
Category

 
>

 
>

 
GetCategories

 *
(

* +
int

+ .
parentCategoryId

/ ?
)

? @
;

@ A
Task 
< 
Category 
> 
GetCategory "
(" #
int# &
id' )
)) *
;* +
Task 
< 
Category 
> 
GetCategory "
(" #
string# )
name* .
). /
;/ 0
Task 
UpdateCategory 
( 
int 
id  "
," #
CategoryDTO$ /
category0 8
)8 9
;9 :
Task 
DeleteCategory 
( 
int 
id  "
)" #
;# $
Task 
< 
Item 
> 
AddItem 
( 
ItemDTO "
itemDTO# *
)* +
;+ ,
Task 
< 
List 
< 
Item 
> 
> 
GetAllItems $
($ %
)% &
;& '
Task 
< 
IPagedCollection 
< 
Item "
>" #
># $
GetItems% -
(- .
	ItemQuery. 7
	itemQuery8 A
)A B
;B C
Task 
< 
Item 
> 
GetItem 
( 
string !
name" &
)& '
;' (
Task 
< 
Item 
> 
GetItem 
( 
int 
id !
)! "
;" #
Task 
< 
ItemDetails 
> 
GetItemDetails (
(( )
int) ,
id- /
)/ 0
;0 1
Task 

UpdateItem 
( 
int 
id 
, 
ItemDTO  '
itemDTO( /
)/ 0
;0 1
Task 

DeleteItem 
( 
int 
id 
) 
;  
} 
} ˜
\C:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CatalogService.BLL\IPagedCollection.cs
	namespace 	
CatalogService
 
. 
BLL 
{ 
public 

	interface 
IPagedCollection %
<% &
T& '
>' (
:) *
IEnumerable+ 6
<6 7
T7 8
>8 9
{ 
int 
CurrentPageNumber 
{ 
get  #
;# $
}% &
int 
? 
NextPageNumber 
{ 
get !
;! "
}# $
int 
? 
PreviousPageNumber 
{  !
get" %
;% &
}' (
int 
LastPageNumber 
{ 
get  
;  !
}" #
int		 
	ItemCount		 
{		 
get		 
;		 
}		 
int

 
PageSize

 
{

 
get

 
;

 
}

 
int 
	PageCount 
{ 
get 
; 
} 
bool 
HasPrevious 
{ 
get 
; 
}  !
bool 
HasNext 
{ 
get 
; 
} 
public 
string 
ToPaginationHeader (
(( )
)) *
;* +
} 
} ô$
[C:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CatalogService.BLL\PagedCollection.cs
	namespace 	
CatalogService
 
. 
BLL 
{ 
public 

class 
PagedCollection  
<  !
T! "
>" #
:$ %
IPagedCollection& 6
<6 7
T7 8
>8 9
{ 
private 
readonly 
List 
< 
T 
>  
_list! &
=' (
new) ,
List- 1
<1 2
T2 3
>3 4
(4 5
)5 6
;6 7
public

 
int

 
CurrentPageNumber

 $
{

% &
get

' *
;

* +
set

, /
;

/ 0
}

1 2
public 
int 
	ItemCount 
{ 
get "
;" #
}$ %
public 
int 
PageSize 
{ 
get !
;! "
}# $
public 
int 
	PageCount 
{ 
get "
;" #
}$ %
public 
int 
LastPageNumber !
=>" $
	PageCount% .
;. /
public 
int 
? 
NextPageNumber "
=># %
HasNext& -
?. /
CurrentPageNumber0 A
+B C
$numD E
:F G
defaultH O
(O P
intP S
?S T
)T U
;U V
public 
int 
? 
PreviousPageNumber &
=>' )
HasPrevious* 5
?6 7
CurrentPageNumber8 I
-J K
$numL M
:N O
defaultP W
(W X
intX [
?[ \
)\ ]
;] ^
public 
bool 
HasPrevious 
=>  "
CurrentPageNumber# 4
>5 6
$num7 8
;8 9
public 
bool 
HasNext 
=> 
CurrentPageNumber 0
<1 2
	PageCount3 <
;< =
public 
PagedCollection 
( 
IReadOnlyList ,
<, -
T- .
>. /
items0 5
,5 6
int7 :
	itemCount; D
,D E
intF I

pageNumberJ T
,T U
intV Y
pageSizeZ b
)b c
{ 	
	ItemCount 
= 
	itemCount !
;! "
CurrentPageNumber 
= 

pageNumber  *
;* +
PageSize 
= 
pageSize 
;  
	PageCount 
= 
( 
PageSize !
>" #
$num$ %
?& '
(( )
int) ,
), -
Math- 1
.1 2
Ceiling2 9
(9 :
	ItemCount: C
/D E
(F G
doubleG M
)M N
PageSizeN V
)V W
:X Y
$numZ [
)[ \
;\ ]
_list 
. 
AddRange 
( 
items  
)  !
;! "
} 	
public 
IEnumerator 
< 
T 
> 
GetEnumerator +
(+ ,
), -
=>. 0
_list1 6
.6 7
GetEnumerator7 D
(D E
)E F
;F G
IEnumerator 
IEnumerable 
.  
GetEnumerator  -
(- .
). /
=>0 2
_list3 8
.8 9
GetEnumerator9 F
(F G
)G H
;H I
public   
string   
ToPaginationHeader   (
(  ( )
)  ) *
{!! 	
var"" 
paginationHeader""  
=""! "
new""# &
PaginationHeader""' 7
(""7 8
CurrentPageNumber""8 I
,""I J
PageSize""K S
,""S T
	PageCount""U ^
,""^ _
	ItemCount""` i
)""i j
;""j k
var## 

jsonHeader## 
=## 
JsonSerializer## +
.##+ ,
	Serialize##, 5
(##5 6
paginationHeader##6 F
)##F G
;##G H
return$$ 

jsonHeader$$ 
;$$ 
}%% 	
}&& 
}'' õ
\C:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CatalogService.BLL\PaginationHeader.cs
	namespace 	
CatalogService
 
. 
BLL 
{ 
public 

class 
PaginationHeader !
{ 
public 
PaginationHeader 
(  
int 
currentPageNumber !
,! "
int 
pageSize 
, 
int 
	pageCount 
, 
int		 
	itemCount		 
)		 
{

 	
CurrentPageNumber 
= 
currentPageNumber  1
;1 2
PageSize 
= 
pageSize 
;  
	PageCount 
= 
	pageCount !
;! "
	ItemCount 
= 
	itemCount !
;! "
} 	
public 
int 
CurrentPageNumber $
{% &
get' *
;* +
}, -
public 
int 
	ItemCount 
{ 
get "
;" #
}$ %
public 
int 
PageSize 
{ 
get !
;! "
}# $
public 
int 
	PageCount 
{ 
get "
;" #
}$ %
} 
} ¨
`C:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CatalogService.BLL\Setup\CatalogProfile.cs
	namespace 	
CatalogService
 
. 
BLL 
. 
Setup "
{ 
public 

class 
CatalogProfile 
:  !
Profile" )
{ 
public 
CatalogProfile 
( 
) 
{		 	
	CreateMap

 
<

 
DAL

 
.

 
Category

 "
,

" #
Category

$ ,
>

, -
(

- .
)

. /
;

/ 0
	CreateMap 
< 
Category 
, 
DAL  #
.# $
Category$ ,
>, -
(- .
). /
. 
	ForMember 
( 
c 
=> 
c  !
.! "
ParentCategory" 0
,0 1
opt2 5
=>6 8
opt9 <
.< =
Ignore= C
(C D
)D E
)E F
;F G
	CreateMap 
< 
CategoryDTO !
,! "
Category# +
>+ ,
(, -
)- .
. 
	ForMember 
( 
c 
=> 
c  !
.! "
ParentCategory" 0
,0 1
opt 
=> 
opt "
." #
MapFrom# *
(* +
(+ ,
d, -
)- .
=>/ 1
d2 3
.3 4
ParentCategoryId4 D
==E G
nullH L
?M N
nullO S
:T U
newV Y
CategoryZ b
(b c
)c d
{e f
Idg i
=j k
(l m
intm p
)p q
dq r
.r s
ParentCategoryId	s É
}
Ñ Ö
)
Ö Ü
)
Ü á
;
á à
	CreateMap 
< 
DAL 
. 
Item 
, 
Item  $
>$ %
(% &
)& '
;' (
	CreateMap 
< 
Item 
, 
DAL 
.  
Item  $
>$ %
(% &
)& '
. 
	ForMember 
( 
i 
=> 
i  !
.! "
Category" *
,* +
opt, /
=>0 2
opt3 6
.6 7
Ignore7 =
(= >
)> ?
)? @
;@ A
	CreateMap 
< 
ItemDTO 
, 
Item #
># $
($ %
)% &
. 
	ForMember 
( 
c 
=> 
c  !
.! "
Category" *
,* +
opt 
=> 
opt "
." #
MapFrom# *
(* +
(+ ,
d, -
)- .
=>/ 1
new2 5
Category6 >
(> ?
)? @
{A B
IdC E
=F G
dH I
.I J

CategoryIdJ T
}U V
)V W
)W X
;X Y
	CreateMap 
< 
DAL 
. 
Item 
, 
MessagingService  0
.0 1
	Contracts1 :
.: ;
Item; ?
>? @
(@ A
)A B
;B C
} 	
} 
} œ
[C:\Users\Alan_Orozco\source\repos\NETMentoringProgram\CatalogService.BLL\Setup\Configure.cs
	namespace 	
CatalogService
 
. 
BLL 
. 
Setup "
{		 
public

 

static

 
class

 
	Configure

 !
{ 
public 
static 
IServiceCollection (
ConfigureBLL) 5
(5 6
this6 :
IServiceCollection; M
servicesN V
)V W
{ 	
services 
. 
AddAutoMapper "
(" #
Assembly# +
.+ , 
GetExecutingAssembly, @
(@ A
)A B
)B C
;C D
services 
. 
	AddScoped 
< 
ICatalogService .
,. /
CatalogEFService0 @
>@ A
(A B
)B C
;C D
services 
. 
AddSingleton !
(! "
s" #
=>$ &
{ 
var 
configuration !
=" #
s$ %
.% &

GetService& 0
<0 1
IConfiguration1 ?
>? @
(@ A
)A B
;B C
var 
rabbitMQSettings $
=% &
configuration' 4
.4 5

GetSection5 ?
(? @
nameof@ F
(F G
RabbitMQSettingsG W
)W X
)X Y
.Y Z
GetZ ]
<] ^
RabbitMQSettings^ n
>n o
(o p
)p q
;q r
var 
conn 
= 
new 
ConnectionFactory 0
(0 1
)1 2
{3 4
HostName5 =
=> ?
rabbitMQSettings@ P
.P Q
HostNameQ Y
}Z [
;[ \
if 
( 
! 
( 
string 
. 
IsNullOrEmpty *
(* +
rabbitMQSettings+ ;
.; <
User< @
)@ A
||B D
stringE K
.K L
IsNullOrEmptyL Y
(Y Z
rabbitMQSettingsZ j
.j k
Passwordk s
)s t
)t u
)u v
{ 
conn 
. 
UserName !
=" #
rabbitMQSettings$ 4
.4 5
User5 9
;9 :
conn 
. 
Password !
=" #
rabbitMQSettings$ 4
.4 5
Password5 =
;= >
} 
return 
conn 
. 
CreateConnection ,
(, -
)- .
;. /
} 
) 
; 
services 
. 
AddSingleton !
<! "
	IMQClient" +
,+ ,
RabbitMQClient- ;
>; <
(< =
)= >
;> ?
services 
. 
AddGraphQLServer %
(% &
)& '
. 
AddType 
< 
CategoryType %
>% &
(& '
)' (
. 
AddType 
< 
ItemType !
>! "
(" #
)# $
.   
AddQueryType   
<   
CatalogQueryType   .
>  . /
(  / 0
)  0 1
.!! 
AddType!! 
<!! 
CategoryInputType!! *
>!!* +
(!!+ ,
)!!, -
."" 
AddMutationType""  
<""  !
CatalogMutationType""! 4
>""4 5
(""5 6
)""6 7
;""7 8
return$$ 
services$$ 
;$$ 
}%% 	
}&& 
}'' 